<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Admin Dashboard | Sales Maturity</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.8.0/Recharts.min.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root{--blue:#0176D3;--blue-dk:#014486;--blue-lt:#1B96FF;--blue-xlt:#D8EDFF;--navy:#032D60;--teal:#06A59A;--green:#2E844A;--green-lt:#EBF7E6;--yellow:#FFB75D;--orange:#FE5000;--red:#BA0517;--g1:#F3F3F3;--g2:#E5E5E5;--g4:#706E6B;--g5:#444444;--r:8px;--sh:0 2px 16px rgba(0,0,0,.10);}
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:'Sora',sans-serif;background:#F0F4FA;color:var(--g5);min-height:100vh;}
#root{min-height:100vh;}
.login-wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--navy) 0%,#093a6e 60%,#0176D3 100%);}
.login-card{background:#fff;border-radius:16px;padding:48px 44px;width:380px;box-shadow:0 8px 40px rgba(0,0,0,.22);text-align:center;}
.login-logo{margin-bottom:24px;}
.login-title{font-size:22px;font-weight:800;color:var(--navy);margin-bottom:6px;}
.login-sub{font-size:14px;color:var(--g4);margin-bottom:28px;}
.login-input{width:100%;padding:11px 14px;border:1.5px solid var(--g2);border-radius:var(--r);font-size:14px;font-family:inherit;outline:none;margin-bottom:12px;transition:border-color .2s;}
.login-input:focus{border-color:var(--blue);box-shadow:0 0 0 3px rgba(1,118,211,.1);}
.login-btn{width:100%;padding:12px;background:var(--blue);color:#fff;border:none;border-radius:var(--r);font-size:15px;font-weight:700;cursor:pointer;font-family:inherit;}
.login-btn:hover{background:var(--blue-dk);}
.login-err{font-size:12px;color:var(--red);margin-bottom:10px;}
.nav{background:var(--navy);padding:0 28px;height:60px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100;box-shadow:0 2px 12px rgba(0,0,0,.25);}
.nav-logo{display:flex;align-items:center;gap:12px;}
.nav-div{width:1px;height:26px;background:rgba(255,255,255,.2);}
.nav-title{color:rgba(255,255,255,.85);font-size:13px;font-weight:500;}
.nav-right{display:flex;align-items:center;gap:12px;}
.nav-count{background:rgba(255,255,255,.12);color:rgba(255,255,255,.7);font-size:11px;padding:3px 10px;border-radius:20px;}
.nav-out{background:transparent;border:1px solid rgba(255,255,255,.25);color:rgba(255,255,255,.65);padding:5px 14px;border-radius:6px;font-size:12px;cursor:pointer;font-family:inherit;}
.nav-out:hover{background:rgba(255,255,255,.1);color:#fff;}
.tabs{background:#fff;border-bottom:1px solid var(--g2);padding:0 28px;display:flex;position:sticky;top:60px;z-index:90;box-shadow:0 1px 4px rgba(0,0,0,.06);}
.tab{padding:14px 18px;font-size:14px;font-weight:600;color:var(--g4);cursor:pointer;border-bottom:3px solid transparent;transition:all .15s;white-space:nowrap;}
.tab:hover{color:var(--blue);}
.tab.active{color:var(--blue);border-bottom-color:var(--blue);}
.main{max-width:1200px;margin:0 auto;padding:28px 24px 80px;}
.setup-banner{background:linear-gradient(135deg,#FFF8E1,#FFF3CD);border:1.5px solid var(--yellow);border-radius:10px;padding:18px 22px;margin-bottom:24px;}
.setup-title{font-size:13px;font-weight:700;color:#8A6200;margin-bottom:5px;}
.setup-body{font-size:12px;color:#7A5800;line-height:1.7;}
.setup-body code{background:rgba(0,0,0,.07);padding:1px 5px;border-radius:3px;font-family:monospace;}
.stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:24px;}
.stat-card{background:#fff;border-radius:10px;padding:20px 22px;box-shadow:var(--sh);}
.stat-lbl{font-size:10px;font-weight:700;letter-spacing:1px;text-transform:uppercase;color:var(--g4);margin-bottom:6px;}
.stat-val{font-size:32px;font-weight:800;color:var(--navy);line-height:1;}
.stat-sub{font-size:12px;color:var(--g4);margin-top:5px;}
.card{background:#fff;border-radius:10px;box-shadow:var(--sh);padding:24px 26px;margin-bottom:20px;}
.card-title{font-size:14px;font-weight:700;color:var(--navy);margin-bottom:16px;display:flex;align-items:center;gap:8px;}
.card-title::after{content:'';flex:1;height:1px;background:var(--g2);margin-left:8px;}
.charts-2{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px;}
.tier-bars{display:flex;flex-direction:column;gap:10px;}
.tier-row{display:flex;align-items:center;gap:12px;}
.tier-lbl{font-size:12px;font-weight:600;width:150px;flex-shrink:0;}
.tier-bg{flex:1;height:26px;border-radius:6px;background:var(--g1);overflow:hidden;}
.tier-fill{height:100%;border-radius:6px;display:flex;align-items:center;padding-left:10px;font-size:12px;font-weight:700;color:#fff;transition:width .8s ease;}
.tier-ct{font-size:13px;font-weight:700;width:28px;text-align:right;}
.dim-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;}
.dim-row{padding:11px 13px;border-radius:8px;border:1.5px solid var(--g2);}
.dim-nm{font-size:11px;font-weight:600;color:var(--g4);margin-bottom:4px;}
.dim-br{display:flex;align-items:center;gap:8px;}
.dim-bg{flex:1;height:6px;border-radius:3px;background:var(--g2);overflow:hidden;}
.dim-fill{height:100%;border-radius:3px;transition:width .8s;}
.dim-val{font-size:13px;font-weight:700;min-width:26px;text-align:right;}
.c1{background:var(--red)}.c2{background:var(--orange)}.c3{background:var(--yellow)}.c4{background:var(--teal)}
.v1{color:var(--red)}.v2{color:var(--orange)}.v3{color:#B8860B}.v4{color:var(--teal)}
.table-wrap{overflow-x:auto;}
table{width:100%;border-collapse:collapse;font-size:13px;}
th{background:var(--g1);padding:9px 13px;text-align:left;font-size:10px;font-weight:700;letter-spacing:.8px;text-transform:uppercase;color:var(--g4);border-bottom:1.5px solid var(--g2);white-space:nowrap;}
td{padding:11px 13px;border-bottom:1px solid var(--g2);vertical-align:middle;}
tr:hover td{background:#FAFAFA;}
tr:last-child td{border-bottom:none;}
.badge{display:inline-block;font-size:10px;font-weight:700;letter-spacing:.8px;text-transform:uppercase;padding:3px 9px;border-radius:20px;white-space:nowrap;}
.b1{background:rgba(186,5,23,.1);color:var(--red)}.b2{background:rgba(254,80,0,.1);color:var(--orange)}.b3{background:rgba(255,183,93,.15);color:#8A6200}.b4{background:rgba(6,165,154,.1);color:var(--teal)}
.btester{background:rgba(1,118,211,.1);color:var(--blue);}
.filter-bar{display:flex;gap:10px;margin-bottom:16px;flex-wrap:wrap;align-items:center;}
.fsel{padding:7px 12px;border:1.5px solid var(--g2);border-radius:6px;font-size:13px;font-family:inherit;color:var(--g5);background:#fff;outline:none;cursor:pointer;}
.fsel:focus{border-color:var(--blue);}
.search{padding:7px 12px;border:1.5px solid var(--g2);border-radius:6px;font-size:13px;font-family:inherit;color:var(--g5);outline:none;flex:1;min-width:200px;}
.search:focus{border-color:var(--blue);}
.btn{padding:7px 16px;border-radius:6px;font-size:13px;font-weight:600;cursor:pointer;border:none;font-family:inherit;display:inline-flex;align-items:center;gap:5px;transition:all .15s;}
.btn-sm{padding:5px 11px;font-size:12px;}
.btn-primary{background:var(--blue);color:#fff;}
.btn-primary:hover{background:var(--blue-dk);}
.btn-outline{background:#fff;color:var(--blue);border:1.5px solid var(--blue);}
.btn-outline:hover{background:var(--blue-xlt);}
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.45);z-index:200;display:flex;align-items:center;justify-content:center;padding:20px;}
.modal{background:#fff;border-radius:12px;max-width:760px;width:100%;max-height:90vh;overflow-y:auto;box-shadow:0 8px 40px rgba(0,0,0,.22);}
.modal-hd{padding:22px 26px 16px;border-bottom:1px solid var(--g2);display:flex;justify-content:space-between;align-items:flex-start;position:sticky;top:0;background:#fff;z-index:1;}
.modal-title{font-size:18px;font-weight:800;color:var(--navy);}
.modal-close{background:none;border:none;font-size:22px;color:var(--g4);cursor:pointer;line-height:1;padding:2px 6px;}
.modal-body{padding:22px 26px;}
.msec{margin-bottom:20px;}
.msec-title{font-size:10px;font-weight:700;letter-spacing:1.2px;text-transform:uppercase;color:var(--blue);margin-bottom:10px;}
.mgrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(155px,1fr));gap:10px;}
.mfl{font-size:11px;color:var(--g4);font-weight:600;}
.mfv{font-size:13px;color:var(--g5);font-weight:600;margin-top:2px;}
.qs-grid{display:grid;grid-template-columns:1fr 1fr;gap:6px;}
.qs-row{display:flex;align-items:center;gap:8px;padding:6px 10px;background:var(--g1);border-radius:6px;}
.qs-lbl{font-size:11px;color:var(--g4);flex:1;}
.qs-val{font-size:13px;font-weight:700;}
/* COMPANIES TAB */
.company-list{display:flex;flex-direction:column;gap:12px;}
.co-card{background:#fff;border-radius:10px;box-shadow:var(--sh);padding:20px 22px;cursor:pointer;border:1.5px solid var(--g2);transition:all .15s;}
.co-card:hover{border-color:var(--blue);box-shadow:0 4px 20px rgba(1,118,211,.12);}
.co-card.tester{border-color:var(--blue-lt);background:#F0F7FF;}
.co-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;}
.co-name{font-size:16px;font-weight:700;color:var(--navy);}
.co-meta{font-size:12px;color:var(--g4);margin-bottom:10px;}
.co-dims{display:grid;grid-template-columns:repeat(4,1fr);gap:6px;}
.co-dim{padding:6px 8px;border-radius:6px;background:var(--g1);text-align:center;}
.co-dim-lbl{font-size:9px;font-weight:700;color:var(--g4);letter-spacing:.5px;}
.co-dim-val{font-size:14px;font-weight:800;}
/* TALKING POINTS */
.tp-card{background:#F8FFF8;border:1.5px solid #C8E8C8;border-radius:10px;padding:18px 20px;margin-bottom:14px;}
.tp-title{font-size:12px;font-weight:700;letter-spacing:.8px;text-transform:uppercase;color:var(--green);margin-bottom:10px;}
.tp-item{display:flex;gap:10px;margin-bottom:8px;}
.tp-num{min-width:22px;height:22px;border-radius:50%;background:var(--green);color:#fff;font-size:11px;font-weight:700;display:flex;align-items:center;justify-content:center;flex-shrink:0;margin-top:1px;}
.tp-text{font-size:13px;color:var(--g5);line-height:1.55;}
/* LIBRARY TAB */
.lib-dim{margin-bottom:28px;}
.lib-dim-title{font-size:15px;font-weight:700;color:var(--navy);margin-bottom:12px;padding-bottom:8px;border-bottom:2px solid var(--blue-xlt);}
.lib-tiers{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;}
.lib-tier-card{padding:14px 16px;border-radius:8px;border:1.5px solid var(--g2);}
.lib-tier-hd{font-size:10px;font-weight:700;letter-spacing:1px;text-transform:uppercase;margin-bottom:6px;}
.lib-tier-desc{font-size:12px;color:var(--g5);line-height:1.55;margin-bottom:8px;}
.lib-sf{font-size:11px;color:var(--blue);font-weight:600;margin-bottom:4px;}
.lib-intervention{font-size:11px;color:var(--g4);line-height:1.5;font-style:italic;}
.ind-list{display:flex;flex-direction:column;gap:7px;max-height:260px;overflow-y:auto;}
.ind-row{display:flex;align-items:center;gap:10px;}
.ind-nm{font-size:12px;color:var(--g5);width:175px;flex-shrink:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.ind-bg{flex:1;height:16px;border-radius:4px;background:var(--g1);overflow:hidden;}
.ind-fill{height:100%;background:var(--blue);border-radius:4px;opacity:.7;}
.ind-ct{font-size:12px;font-weight:700;color:var(--g4);width:18px;text-align:right;}
.empty{text-align:center;padding:60px 20px;}
.empty-icon{font-size:48px;margin-bottom:14px;}
.empty-title{font-size:18px;font-weight:700;color:var(--navy);margin-bottom:8px;}
.empty-desc{font-size:14px;color:var(--g4);line-height:1.6;max-width:480px;margin:0 auto;}
@media(max-width:768px){.stats-grid,.charts-2{grid-template-columns:1fr 1fr;}.dim-grid,.co-dims{grid-template-columns:1fr 1fr;}.qs-grid{grid-template-columns:1fr;}.lib-tiers{grid-template-columns:1fr 1fr;}}
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const { useState, useEffect, useMemo } = React;
const { BarChart, Bar, XAxis, YAxis, Tooltip, ResponsiveContainer, RadarChart: RC, PolarGrid, PolarAngleAxis, Radar, LineChart, Line, CartesianGrid, Legend } = Recharts;

/* ‚ïê‚ïê‚ïê CONFIG ‚ïê‚ïê‚ïê */
const ADMIN_PASSWORD    = "Martha314!";
const GOOGLE_SHEETS_API = "https://script.google.com/a/macros/salesforce.com/s/AKfycbx6e8OBmuWhi-4sfJ8dsIoh1dlDZAy7pxkHR_snNxSDhdJQ3VOV0wBCEncpmqkT9fYe/exec";
const TESTER_DOMAINS    = ["salesforce.com"];

/* ‚ïê‚ïê‚ïê SAMPLE DATA ‚ïê‚ïê‚ïê */
const SAMPLE_DATA = [
  {timestamp:"2024-01-15T10:23:00Z",fullName:"Alex Rivera",email:"arivera@techcorp.com",businessName:"TechCorp Inc",title:"SVP Sales",industry:"Technology: Software / SaaS",timeline:"1‚Äì3 Months",confidence:8,overallScore:2.3,overallTier:"Repeatable / Developing",emailDomain:"techcorp.com",isTester:false,DIM_Growth_Strategy:2.0,DIM_Sales_Process___Governance:2.2,DIM_Forecasting___Pipeline:2.5,DIM_Pricing___Quote_to_Cash:1.8,DIM_Enablement___Coaching:2.6,DIM_Data__CRM___AI:2.1,DIM_Operations___Lifecycle:2.4,topOutcome:"Improve forecast accuracy to within 5% each quarter"},
  {timestamp:"2024-01-18T14:45:00Z",fullName:"Sarah Chen",email:"schen@techcorp.com",businessName:"TechCorp Inc",title:"VP Revenue",industry:"Technology: Software / SaaS",timeline:"1‚Äì3 Months",confidence:7,overallScore:2.1,overallTier:"Repeatable / Developing",emailDomain:"techcorp.com",isTester:false,DIM_Growth_Strategy:1.8,DIM_Sales_Process___Governance:2.0,DIM_Forecasting___Pipeline:2.3,DIM_Pricing___Quote_to_Cash:1.9,DIM_Enablement___Coaching:2.4,DIM_Data__CRM___AI:2.0,DIM_Operations___Lifecycle:2.2,topOutcome:"Build consistent pipeline across all reps"},
  {timestamp:"2024-01-20T09:00:00Z",fullName:"Mike Johnson",email:"mjohnson@salesforce.com",businessName:"Salesforce",title:"AE",industry:"Technology: Software / SaaS",timeline:"1‚Äì3 Months",confidence:9,overallScore:3.8,overallTier:"Optimized / Agentic",emailDomain:"salesforce.com",isTester:true,DIM_Growth_Strategy:3.9,DIM_Sales_Process___Governance:3.8,DIM_Forecasting___Pipeline:3.7,DIM_Pricing___Quote_to_Cash:3.8,DIM_Enablement___Coaching:3.9,DIM_Data__CRM___AI:3.8,DIM_Operations___Lifecycle:3.6,topOutcome:"Test the assessment"},
  {timestamp:"2024-02-01T11:30:00Z",fullName:"Jennifer Park",email:"jpark@manufact.com",businessName:"Precision Mfg",title:"SVP of Sales",industry:"Manufacturing & Industrial",timeline:"7‚Äì12 Months",confidence:6,overallScore:1.7,overallTier:"Ad Hoc / Reactive",emailDomain:"manufact.com",isTester:false,DIM_Growth_Strategy:1.5,DIM_Sales_Process___Governance:1.8,DIM_Forecasting___Pipeline:1.6,DIM_Pricing___Quote_to_Cash:1.5,DIM_Enablement___Coaching:2.0,DIM_Data__CRM___AI:1.7,DIM_Operations___Lifecycle:1.9,topOutcome:"Get reps to actually use Salesforce"},
  {timestamp:"2024-02-10T08:55:00Z",fullName:"Lisa Thompson",email:"lthompson@finserv.com",businessName:"FinServ Partners",title:"CRO",industry:"Financial Services (Banking)",timeline:"1‚Äì3 Months",confidence:9,overallScore:3.4,overallTier:"Optimized / Agentic",emailDomain:"finserv.com",isTester:false,DIM_Growth_Strategy:3.6,DIM_Sales_Process___Governance:3.5,DIM_Forecasting___Pipeline:3.3,DIM_Pricing___Quote_to_Cash:3.2,DIM_Enablement___Coaching:3.4,DIM_Data__CRM___AI:3.6,DIM_Operations___Lifecycle:3.1,topOutcome:"Deploy Agentforce across our revenue team"},
];

const TIER_INFO=[null,
  {label:"Ad Hoc / Reactive",short:"Ad Hoc",cls:"b1",color:"#BA0517"},
  {label:"Repeatable / Developing",short:"Repeatable",cls:"b2",color:"#FE5000"},
  {label:"Defined / Measured",short:"Defined",cls:"b3",color:"#B8860B"},
  {label:"Optimized / Agentic",short:"Optimized",cls:"b4",color:"#06A59A"},
];
const DIMENSIONS=["Growth Strategy","Sales Process & Governance","Forecasting & Pipeline","Pricing & Quote-to-Cash","Enablement & Coaching","Data, CRM & AI","Operations & Lifecycle"];
const DIM_KEYS=["DIM_Growth_Strategy","DIM_Sales_Process___Governance","DIM_Forecasting___Pipeline","DIM_Pricing___Quote_to_Cash","DIM_Enablement___Coaching","DIM_Data__CRM___AI","DIM_Operations___Lifecycle"];

/* Best practices library ‚Äî drawn directly from the briefing doc */
const BEST_PRACTICES = {
  "Growth Strategy":{
    1:{what:"Growth is reactive ‚Äî new lead volume is the only lever; no intentional expansion motion.",sf:"Revenue type tags on Opportunities; no renewal/upsell pipeline defined.",intervention:"Define expansion plays, account segmentation model, and expansion KPIs in Salesforce. Identify top 20% of accounts for intentional growth outreach."},
    2:{what:"Some expansion activity but it's unmeasured and not a managed motion.",sf:"Opportunity record types for new vs. expansion; basic account segmentation.",intervention:"Build a separate expansion pipeline in Salesforce, assign account owners, and create a renewal dashboard with 90-day advance visibility."},
    3:{what:"Balanced acquisition and expansion; both are tracked but optimization is limited.",sf:"Account health scores, renewal pipeline with forecast categories, account segmentation.",intervention:"Implement automated account health scoring and proactive intervention triggers. Introduce Agentforce-ready signals for expansion opportunity detection."},
    4:{what:"Expansion and renewal are the primary profit drivers; fully systematized and measured.",sf:"AI-assisted account scoring, automated expansion triggers, renewal forecasting.",intervention:"Extend into Agentforce agents that proactively surface expansion risk/opportunity and trigger seller action without manual pipeline review."},
  },
  "Sales Process & Governance":{
    1:{what:"Each rep qualifies and stages deals independently ‚Äî no common process.",sf:"Opportunity Stage field exists but is not enforced; no required fields by stage.",intervention:"Define ICP criteria and map to Lead/Opportunity fields. Implement Salesforce Path with required key fields and guidance text per stage."},
    2:{what:"Process documentation exists but adoption is inconsistent ‚Äî some reps follow it, others don't.",sf:"Path is configured but not actively coached to; required fields are minimal.",intervention:"Enforce stage progression discipline through Path key fields, conduct weekly pipeline reviews against stage criteria, and tie coaching to stage conversion metrics."},
    3:{what:"Stages are defined, enforced, and used to drive forecast quality.",sf:"Path with required fields, in-app guidance, stage conversion dashboards.",intervention:"Layer AI-assisted qualification signals and next-best-action guidance. Pilot automated stage progression recommendations based on activity patterns."},
    4:{what:"Process governance is a competitive advantage ‚Äî data-driven and continuously improving.",sf:"Automated stage health monitoring, AI-guided qualification, dynamic playbook surfacing.",intervention:"Deploy qualification and pipeline governance agents via Agentforce. Connect process adherence data to seller performance reviews."},
  },
  "Forecasting & Pipeline":{
    1:{what:"Forecasting is based on manager gut feel with no structured process.",sf:"Forecast Category field unused; no forecast hierarchy configured.",intervention:"Configure Salesforce Forecast Categories (Pipeline, Best Case, Commit, Closed). Establish a weekly forecast commit cadence with manager roll-up."},
    2:{what:"A forecast process exists but accuracy is inconsistent and not formally tracked.",sf:"Forecast Categories in use; no accuracy tracking against actuals.",intervention:"Build a Forecast vs. Actual tracking dashboard. Introduce pipeline health KPIs: stage aging, coverage ratio, and next-step completion rates."},
    3:{what:"Criteria-based forecasting is cadenced and tracked against actuals.",sf:"Forecast accuracy dashboards, pipeline coverage reports, stage aging alerts.",intervention:"Layer Einstein Forecasting or AI-assisted scenario modeling. Automate pipeline risk alerts and incorporate deal sentiment signals."},
    4:{what:"Forecasting is data-driven, auditable, and continuously improving.",sf:"AI forecasting, predictive deal scoring, automated risk identification.",intervention:"Extend into Agentforce-powered pipeline review agents that surface risk, suggest actions, and update forecast categories without rep intervention."},
  },
  "Pricing & Quote-to-Cash":{
    1:{what:"Discounting is ad hoc; quoting is manual and inconsistent.",sf:"No CPQ; discount fields exist but no approval workflows.",intervention:"Establish pricing guidelines and minimum approval thresholds. Deploy Salesforce CPQ for standard product lines with basic approval rules."},
    2:{what:"Pricing guidelines exist but exceptions are frequent and untracked.",sf:"CPQ partially deployed; approval workflows for some products only.",intervention:"Complete CPQ rollout with Advanced Approvals for all product lines. Build discount governance reporting to surface leakage patterns."},
    3:{what:"CPQ is in use with governed approvals; quote cycle time is tracked.",sf:"CPQ with Advanced Approvals, quote cycle time dashboard, margin visibility.",intervention:"Integrate order and invoice status into Salesforce to eliminate 'where is my order?' seller distraction. Connect CPQ to ERP for real-time pricing and availability."},
    4:{what:"End-to-end quote-to-cash is integrated, measurable, and optimized.",sf:"CPQ + Order + ERP integration; automated renewal quoting; margin analytics.",intervention:"Extend into automated renewal management and AI-assisted deal structuring recommendations via Agentforce."},
  },
  "Enablement & Coaching":{
    1:{what:"Enablement is ad hoc; coaching happens when managers have time.",sf:"No playbooks in Salesforce; coaching not tracked.",intervention:"Build 2‚Äì3 segment-specific playbooks and host them in Salesforce. Establish a biweekly structured coaching cadence with a defined skill rubric."},
    2:{what:"Enablement content exists but is inconsistently applied and not embedded in workflow.",sf:"Some documents in Salesforce Files; coaching 1:1s exist but vary by manager.",intervention:"Embed playbooks in Salesforce workflow using In-App Guidance. Tie coaching sessions to observable opportunity-level behaviors in CRM."},
    3:{what:"Enablement and coaching are structured, consistent, and tied to skill development.",sf:"In-App Guidance with analytics, coaching scorecards tied to CRM activity.",intervention:"Measure enablement effectiveness against win rate and stage conversion. Continuously update playbooks based on win/loss analysis."},
    4:{what:"Enablement is a measured, data-driven function driving business outcomes.",sf:"Enablement analytics, AI-assisted coaching tools, real-time guidance agents.",intervention:"Deploy Agentforce coaching agents that surface deal-specific guidance at point of need based on opportunity characteristics and seller history."},
  },
  "Data, CRM & AI":{
    1:{what:"CRM data is incomplete and untrustworthy; shadow systems (spreadsheets) dominate.",sf:"Low field completion rates; duplicate records common; adoption inconsistent.",intervention:"Simplify Salesforce to minimum required fields. Configure duplicate and matching rules. Deploy In-App Guidance to reduce friction. Run a data import cleanup sprint."},
    2:{what:"Salesforce is used but adoption and data quality are uneven across the team.",sf:"Some required fields; basic duplicate rules; adoption varies by manager.",intervention:"Define and enforce data minimums by stage using Path. Establish shared metric definitions (MQL, SQL, ARR, Churn) across revenue teams. Publish a metric catalog."},
    3:{what:"Salesforce is the system of record with strong adoption and trusted reporting.",sf:"High field completion, shared metric definitions, duplicate prevention, trusted dashboards.",intervention:"Pilot Einstein Lead Scoring and Opportunity Health. Introduce automated data capture (activity logging). Build the data foundation for Agentforce deployment."},
    4:{what:"CRM data is clean, trusted, and the active foundation for intelligent automation.",sf:"Automated capture, AI scoring, clean data grounding Agentforce agents.",intervention:"Deploy Agentforce agents grounded in CRM data with deterministic Flow/API actions. Implement Einstein Trust Layer protections for safe agentic operation."},
  },
  "Operations & Lifecycle":{
    1:{what:"Sales and post-sales operate in silos; handoffs are ad hoc and lossy.",sf:"No handoff artifacts in Salesforce; Cases not linked to Account revenue context.",intervention:"Define handoff ownership and create standard handoff checklists as Tasks in Salesforce. Link Cases to Account and Opportunity context for seller visibility."},
    2:{what:"Handoff process exists but lacks consistency and feedback loops.",sf:"Handoff templates exist; some Cases visible to sales; no cycle time measurement.",intervention:"Implement standardized handoff packages triggered by Opportunity Close. Automate onboarding milestone tracking and expose service/order status to sellers."},
    3:{what:"Lifecycle handoffs are structured, measured, and improving.",sf:"Automated handoff creation, onboarding milestones tracked, seller-facing service dashboard.",intervention:"Close the feedback loop between service outcomes and sales process. Reduce seller time diverted to order/service inquiries through self-serve portals."},
    4:{what:"The revenue lifecycle is integrated and proactively managed.",sf:"Automated lifecycle monitoring, account health signals, proactive intervention triggers.",intervention:"Deploy Agentforce agents that monitor account health, detect churn risk, and trigger expansion or save workflows without human initiation."},
  },
};

const getTier=a=>a<1.75?1:a<2.5?2:a<3.25?3:4;
const scoreStyle=s=>s<1.75?{bar:"c1",val:"v1"}:s<2.5?{bar:"c2",val:"v2"}:s<3.25?{bar:"c3",val:"v3"}:{bar:"c4",val:"v4"};
const scoreColor=s=>s<1.75?"#BA0517":s<2.5?"#FE5000":s<3.25?"#B8860B":"#06A59A";
const fmtDate=ts=>new Date(ts).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"});
const arrAvg=arr=>arr.length?arr.reduce((a,b)=>a+b,0)/arr.length:0;
const isTesterDomain=d=>TESTER_DOMAINS.includes((d||"").toLowerCase());

const SFLogo=()=>(
  <img src="https://upload.wikimedia.org/wikipedia/commons/f/f9/Salesforce.com_logo.svg" height="32" style={{display:"block",filter:"brightness(0) invert(1)"}} alt="Salesforce"/>
);

function LoginScreen({onLogin}){
  const [pw,setPw]=useState(""), [err,setErr]=useState(false);
  const attempt=()=>{if(pw===ADMIN_PASSWORD)onLogin();else{setErr(true);setPw("");}};
  return(
    <div className="login-wrap">
      <div className="login-card">
        <div className="login-logo"><SFLogo style={{filter:"none"}}/></div>
        <div className="login-title">Admin Dashboard</div>
        <div className="login-sub">Sales Maturity Response Analytics</div>
        {err&&<div className="login-err">Incorrect password. Try again.</div>}
        <input className="login-input" type="password" placeholder="Enter admin password" value={pw} onChange={e=>{setPw(e.target.value);setErr(false);}} onKeyDown={e=>e.key==="Enter"&&attempt()}/>
        <button className="login-btn" onClick={attempt}>Sign In ‚Üí</button>
        <div style={{fontSize:11,color:"var(--g4)",marginTop:14}}>Change password in CONFIG block at top of admin.html</div>
      </div>
    </div>
  );
}

function SetupBanner({configured}){
  if(configured)return null;
  return(
    <div className="setup-banner">
      <div className="setup-title">‚öôÔ∏è Running on Sample Data ‚Äî Connect Google Sheets to see real responses</div>
      <div className="setup-body">
        <strong>1.</strong> Add <code>doGet()</code> to your Apps Script (see comment at bottom of this file)<br/>
        <strong>2.</strong> Create a new Deployment and copy the URL<br/>
        <strong>3.</strong> Replace <code>https://script.google.com/a/macros/salesforce.com/s/AKfycbx6e8OBmuWhi-4sfJ8dsIoh1dlDZAy7pxkHR_snNxSDhdJQ3VOV0wBCEncpmqkT9fYe/exec</code> in both <code>GOOGLE_SHEETS_API</code> fields in this file and in index.html
      </div>
    </div>
  );
}

function EmptyState(){
  return(
    <div className="card"><div className="empty">
      <div className="empty-icon">üìã</div>
      <div className="empty-title">No responses yet</div>
      <div className="empty-desc">Once respondents complete the assessment, their data will appear here.</div>
    </div></div>
  );
}

/* ‚îÄ‚îÄ‚îÄ OVERVIEW TAB ‚îÄ‚îÄ‚îÄ */
function OverviewTab({data}){
  if(!data.length)return<EmptyState/>;
  const real=data.filter(r=>!isTesterDomain(r.emailDomain));
  const scores=real.map(r=>parseFloat(r.overallScore)||0);
  const avgS=arrAvg(scores);
  const tierCounts={1:0,2:0,3:0,4:0};
  real.forEach(r=>{tierCounts[getTier(parseFloat(r.overallScore)||0)]++;});
  const dimAvgs=DIMENSIONS.map((d,i)=>{
    const vals=real.map(r=>parseFloat(r[DIM_KEYS[i]])||0).filter(v=>v>0);
    return{dim:d,avg:vals.length?arrAvg(vals):0};
  });
  const industryMap={};
  real.forEach(r=>{if(r.industry)industryMap[r.industry]=(industryMap[r.industry]||0)+1;});
  const industries=Object.entries(industryMap).sort((a,b)=>b[1]-a[1]).slice(0,8);
  const maxInd=industries[0]?.[1]||1;
  const tlMap={};
  real.forEach(r=>{if(r.timeline)tlMap[r.timeline]=(tlMap[r.timeline]||0)+1;});
  const tlData=Object.entries(tlMap).map(([name,count])=>({name,count}));
  const radarData=dimAvgs.map(d=>({subject:d.dim.length>16?d.dim.substring(0,15)+"‚Ä¶":d.dim,A:parseFloat(d.avg.toFixed(2)),fullMark:4}));
  const confData=[1,2,3,4,5,6,7,8,9,10].map(n=>({name:String(n),count:real.filter(r=>parseInt(r.confidence)===n).length}));
  const topT=getTier(avgS);
  const companies=new Set(real.map(r=>r.emailDomain)).size;
  const testers=data.filter(r=>isTesterDomain(r.emailDomain)).length;
  return(
    <div>
      <div className="stats-grid">
        <div className="stat-card"><div className="stat-lbl">Customer Responses</div><div className="stat-val">{real.length}</div><div className="stat-sub">{testers} tester{testers!==1?"s":""} excluded</div></div>
        <div className="stat-card"><div className="stat-lbl">Avg Maturity Score</div><div className="stat-val" style={{color:scoreColor(avgS)}}>{avgS.toFixed(2)}</div><div className="stat-sub">out of 4.0</div></div>
        <div className="stat-card"><div className="stat-lbl">Dominant Tier</div><div className="stat-val" style={{fontSize:17,paddingTop:6}}>{TIER_INFO[topT].short}</div><div className="stat-sub">{TIER_INFO[topT].label}</div></div>
        <div className="stat-card"><div className="stat-lbl">Unique Companies</div><div className="stat-val">{companies}</div><div className="stat-sub">by email domain</div></div>
      </div>
      <div className="charts-2">
        <div className="card">
          <div className="card-title">Tier Distribution (Customers Only)</div>
          <div className="tier-bars">
            {[4,3,2,1].map(t=>{
              const ct=tierCounts[t],pct=real.length?Math.round(ct/real.length*100):0;
              const colors={1:"#BA0517",2:"#FE5000",3:"#FFB75D",4:"#06A59A"};
              return(<div key={t} className="tier-row">
                <div className="tier-lbl"><span className={`badge b${t}`}>{TIER_INFO[t].short}</span></div>
                <div className="tier-bg"><div className="tier-fill" style={{width:`${pct}%`,background:colors[t]}}>{pct>8?`${pct}% (${ct})`:""}</div></div>
                <div className="tier-ct">{ct}</div>
              </div>);
            })}
          </div>
        </div>
        <div className="card">
          <div className="card-title">Avg Score by Dimension</div>
          <div className="dim-grid">
            {dimAvgs.map((d,i)=>{const s=scoreStyle(d.avg);return(
              <div key={i} className="dim-row">
                <div className="dim-nm">{d.dim}</div>
                <div className="dim-br"><div className="dim-bg"><div className={`dim-fill ${s.bar}`} style={{width:`${(d.avg/4)*100}%`}}/></div><div className={`dim-val ${s.val}`}>{d.avg.toFixed(2)}</div></div>
              </div>
            );})}
          </div>
        </div>
      </div>
      <div className="charts-2">
        <div className="card">
          <div className="card-title">Radar: Avg Maturity by Dimension</div>
          <ResponsiveContainer width="100%" height={260}>
            <RC data={radarData}><PolarGrid stroke="#E5E5E5"/><PolarAngleAxis dataKey="subject" tick={{fontSize:10,fill:"#032D60",fontWeight:600}}/><Radar name="Avg" dataKey="A" stroke="#0176D3" fill="#0176D3" fillOpacity={0.13} strokeWidth={2}/><Tooltip formatter={v=>[parseFloat(v).toFixed(2),"Avg Score"]}/></RC>
          </ResponsiveContainer>
        </div>
        <div className="card">
          <div className="card-title">Confidence Distribution</div>
          <ResponsiveContainer width="100%" height={260}>
            <BarChart data={confData} margin={{top:5,right:5,bottom:5,left:-20}}><CartesianGrid strokeDasharray="3 3" stroke="#E5E5E5"/><XAxis dataKey="name" tick={{fontSize:11}}/><YAxis tick={{fontSize:11}}/><Tooltip/><Bar dataKey="count" fill="#0176D3" radius={[4,4,0,0]} name="Responses"/></BarChart>
          </ResponsiveContainer>
        </div>
      </div>
      <div className="charts-2">
        <div className="card">
          <div className="card-title">Top Industries</div>
          <div className="ind-list">
            {industries.map(([nm,ct])=>(<div key={nm} className="ind-row"><div className="ind-nm" title={nm}>{nm}</div><div className="ind-bg"><div className="ind-fill" style={{width:`${(ct/maxInd)*100}%`}}/></div><div className="ind-ct">{ct}</div></div>))}
          </div>
        </div>
        <div className="card">
          <div className="card-title">Sales Transformation Timeline</div>
          <ResponsiveContainer width="100%" height={210}>
            <BarChart data={tlData} margin={{top:5,right:5,bottom:40,left:-20}}><CartesianGrid strokeDasharray="3 3" stroke="#E5E5E5"/><XAxis dataKey="name" tick={{fontSize:10}} angle={-20} textAnchor="end" interval={0}/><YAxis tick={{fontSize:11}}/><Tooltip/><Bar dataKey="count" fill="#06A59A" radius={[4,4,0,0]} name="Count"/></BarChart>
          </ResponsiveContainer>
        </div>
      </div>
    </div>
  );
}

/* ‚îÄ‚îÄ‚îÄ RESPONSES TAB ‚îÄ‚îÄ‚îÄ */
function ResponsesTab({data,onSelect}){
  const [search,setSearch]=useState("");
  const [tierFilter,setTierFilter]=useState("all");
  const [showTesters,setShowTesters]=useState(false);
  const [srt,setSrt]=useState("newest");
  const filtered=useMemo(()=>{
    let d=[...data];
    if(!showTesters)d=d.filter(r=>!isTesterDomain(r.emailDomain));
    if(search)d=d.filter(r=>(r.fullName+r.businessName+r.email+(r.industry||"")).toLowerCase().includes(search.toLowerCase()));
    if(tierFilter!=="all")d=d.filter(r=>getTier(parseFloat(r.overallScore)||0)===parseInt(tierFilter));
    if(srt==="newest")d.sort((a,b)=>new Date(b.timestamp)-new Date(a.timestamp));
    else if(srt==="oldest")d.sort((a,b)=>new Date(a.timestamp)-new Date(b.timestamp));
    else if(srt==="high")d.sort((a,b)=>parseFloat(b.overallScore)-parseFloat(a.overallScore));
    else d.sort((a,b)=>parseFloat(a.overallScore)-parseFloat(b.overallScore));
    return d;
  },[data,search,tierFilter,srt,showTesters]);
  if(!data.length)return<EmptyState/>;
  return(
    <div>
      <div className="filter-bar">
        <input className="search" placeholder="üîç Search name, company, email‚Ä¶" value={search} onChange={e=>setSearch(e.target.value)}/>
        <select className="fsel" value={tierFilter} onChange={e=>setTierFilter(e.target.value)}>
          <option value="all">All Tiers</option><option value="1">Ad Hoc</option><option value="2">Repeatable</option><option value="3">Defined</option><option value="4">Optimized</option>
        </select>
        <select className="fsel" value={srt} onChange={e=>setSrt(e.target.value)}>
          <option value="newest">Newest</option><option value="oldest">Oldest</option><option value="high">Highest Score</option><option value="low">Lowest Score</option>
        </select>
        <label style={{display:"flex",alignItems:"center",gap:6,fontSize:13,color:"var(--g4)",cursor:"pointer",whiteSpace:"nowrap"}}>
          <input type="checkbox" checked={showTesters} onChange={e=>setShowTesters(e.target.checked)}/> Show Testers
        </label>
        <span style={{fontSize:12,color:"var(--g4)",whiteSpace:"nowrap"}}>{filtered.length} of {data.length}</span>
      </div>
      <div className="card" style={{padding:0}}>
        <div className="table-wrap">
          <table>
            <thead><tr><th>Date</th><th>Name</th><th>Company</th><th>Title</th><th>Score</th><th>Tier</th><th>Domain</th><th></th></tr></thead>
            <tbody>
              {filtered.map((r,i)=>{
                const sc=parseFloat(r.overallScore)||0,t=getTier(sc),tester=isTesterDomain(r.emailDomain);
                return(<tr key={i}>
                  <td style={{fontSize:12,color:"var(--g4)",whiteSpace:"nowrap"}}>{fmtDate(r.timestamp)}</td>
                  <td style={{fontWeight:600,whiteSpace:"nowrap"}}>{r.fullName}</td>
                  <td>{r.businessName}</td>
                  <td style={{fontSize:12,color:"var(--g4)"}}>{r.title}</td>
                  <td><span style={{fontWeight:800,fontSize:15,color:scoreColor(sc)}}>{sc.toFixed(1)}</span></td>
                  <td><span className={`badge ${tester?"btester":`b${t}`}`}>{tester?"üß™ Tester":TIER_INFO[t].short}</span></td>
                  <td style={{fontSize:12,color:"var(--g4)"}}>{r.emailDomain}</td>
                  <td><button className="btn btn-sm btn-outline" onClick={()=>onSelect(r)}>View ‚Üí</button></td>
                </tr>);
              })}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  );
}

/* ‚îÄ‚îÄ‚îÄ COMPANIES TAB ‚îÄ‚îÄ‚îÄ */
function CompaniesTab({data,onSelectCompany}){
  const real=data.filter(r=>!isTesterDomain(r.emailDomain));
  const testers=data.filter(r=>isTesterDomain(r.emailDomain));
  const companyMap={};
  real.forEach(r=>{
    const d=r.emailDomain||"unknown";
    if(!companyMap[d])companyMap[d]={domain:d,name:r.businessName||d,responses:[],isTester:false};
    companyMap[d].responses.push(r);
  });
  const companies=Object.values(companyMap).sort((a,b)=>b.responses.length-a.responses.length);
  const getDimAvgs=responses=>DIMENSIONS.map((d,i)=>{
    const vals=responses.map(r=>parseFloat(r[DIM_KEYS[i]])||0).filter(v=>v>0);
    return{dim:d,avg:vals.length?arrAvg(vals):0};
  });
  return(
    <div>
      {testers.length>0&&(
        <div className="card co-card tester" style={{marginBottom:16,cursor:"pointer"}} onClick={()=>onSelectCompany({domain:"salesforce.com",name:"üß™ Testers",responses:testers,isTester:true})}>
          <div className="co-header">
            <div className="co-name">üß™ Testers <span className="badge btester" style={{marginLeft:8}}>@salesforce.com + tester domains</span></div>
            <div style={{fontSize:13,color:"var(--g4)"}}>{testers.length} response{testers.length!==1?"s":""}</div>
          </div>
          <div style={{fontSize:12,color:"var(--g4)"}}>Excluded from customer analytics. Click to review.</div>
        </div>
      )}
      {!companies.length&&<EmptyState/>}
      <div className="company-list">
        {companies.map(co=>{
          const scores=co.responses.map(r=>parseFloat(r.overallScore)||0);
          const avg=arrAvg(scores),t=getTier(avg);
          const dimAs=getDimAvgs(co.responses);
          return(
            <div key={co.domain} className="co-card" onClick={()=>onSelectCompany(co)}>
              <div className="co-header">
                <div><div className="co-name">{co.name}</div><div style={{fontSize:11,color:"var(--g4)"}}>{co.domain}</div></div>
                <div style={{textAlign:"right"}}>
                  <div style={{fontSize:28,fontWeight:800,color:scoreColor(avg),lineHeight:1}}>{avg.toFixed(1)}</div>
                  <div><span className={`badge b${t}`}>{TIER_INFO[t].short}</span></div>
                  <div style={{fontSize:12,color:"var(--g4)",marginTop:4}}>{co.responses.length} respondent{co.responses.length!==1?"s":""}</div>
                </div>
              </div>
              <div className="co-dims">
                {dimAs.map((d,i)=>{const s=scoreStyle(d.avg);return(
                  <div key={i} className="co-dim">
                    <div className="co-dim-lbl">{d.dim.split(" ")[0]}</div>
                    <div className={`co-dim-val ${s.val}`}>{d.avg.toFixed(1)}</div>
                  </div>
                );})}
              </div>
            </div>
          );
        })}
      </div>
    </div>
  );
}

/* ‚îÄ‚îÄ‚îÄ LIBRARY TAB ‚îÄ‚îÄ‚îÄ */
function LibraryTab(){
  return(
    <div>
      <div className="card" style={{marginBottom:16,background:"#F0F7FF",border:"1.5px solid var(--blue-xlt)"}}>
        <div style={{fontSize:13,color:"var(--navy)",fontWeight:600,marginBottom:4}}>üìö Consultant Reference Library</div>
        <div style={{fontSize:13,color:"var(--g4)",lineHeight:1.6}}>This library is drawn directly from the Agent-Ready Briefing document. Use it to build your prescription after reviewing the diagnostic results. It is never visible to respondents.</div>
      </div>
      {DIMENSIONS.map(dim=>{
        const bp=BEST_PRACTICES[dim];
        if(!bp)return null;
        return(
          <div key={dim} className="lib-dim">
            <div className="lib-dim-title">{dim}</div>
            <div className="lib-tiers">
              {[1,2,3,4].map(t=>{
                const ti=TIER_INFO[t],b=bp[t];
                if(!b)return null;
                return(
                  <div key={t} className="lib-tier-card">
                    <div className="lib-tier-hd" style={{color:ti.color}}>Tier {t} ‚Äî {ti.short}</div>
                    <div className="lib-tier-desc"><strong>State:</strong> {b.what}</div>
                    <div className="lib-sf">üîµ Salesforce signals: <span style={{fontWeight:400,color:"var(--g4)"}}>{b.sf}</span></div>
                    <div className="lib-intervention">üí° {b.intervention}</div>
                  </div>
                );
              })}
            </div>
          </div>
        );
      })}
    </div>
  );
}

/* ‚îÄ‚îÄ‚îÄ COMPANY DETAIL MODAL ‚îÄ‚îÄ‚îÄ */
function CompanyModal({company,onClose}){
  if(!company)return null;
  const responses=company.responses;
  const scores=responses.map(r=>parseFloat(r.overallScore)||0);
  const avg=arrAvg(scores),t=getTier(avg),ti=TIER_INFO[t];
  const dimAvgs=DIMENSIONS.map((d,i)=>{
    const vals=responses.map(r=>parseFloat(r[DIM_KEYS[i]])||0).filter(v=>v>0);
    return{dim:d,avg:vals.length?arrAvg(vals):0,key:DIM_KEYS[i]};
  });
  const sorted=[...dimAvgs].sort((a,b)=>a.avg-b.avg);
  const gaps=sorted.slice(0,3);
  const TALKING_POINTS={
    "Growth Strategy":"Their growth motion appears primarily new-logo focused with limited expansion infrastructure. Open a conversation around account segmentation and what a systematic renewal/upsell motion could mean for margin.",
    "Sales Process & Governance":"Stage discipline and qualification consistency are areas of risk. Ask about how pipeline reviews are run today and whether reps are operating from a common playbook.",
    "Forecasting & Pipeline":"Forecast confidence is low. This is often a symptom of CRM data quality and stage discipline gaps. Ask how accurate their last 3 quarters of forecasts were vs. actuals.",
    "Pricing & Quote-to-Cash":"Pricing governance and quote cycle time are likely pain points. Ask how long a quote takes and how often deals require VP-level discount approvals.",
    "Enablement & Coaching":"Coaching is likely inconsistent or unmeasured. Ask whether onboarding ramp time is tracked and how managers currently differentiate high vs. low performers.",
    "Data, CRM & AI":"CRM trust and adoption are below the threshold needed for predictive tools. Ask how often leadership makes decisions from Salesforce reports vs. spreadsheets.",
    "Operations & Lifecycle":"Post-sale handoffs and lifecycle visibility are creating friction. Ask how often sellers get pulled into 'where is my order?' conversations and what that costs in selling time.",
  };
  return(
    <div className="modal-overlay" onClick={e=>e.target===e.currentTarget&&onClose()}>
      <div className="modal">
        <div className="modal-hd">
          <div>
            <div className="modal-title">{company.name}</div>
            <div style={{fontSize:13,color:"var(--g4)",marginTop:3}}>{company.domain} ¬∑ {responses.length} respondent{responses.length!==1?"s":""}</div>
          </div>
          <button className="modal-close" onClick={onClose}>√ó</button>
        </div>
        <div className="modal-body">
          {/* Aggregate score */}
          <div className="msec">
            <div className="msec-title">Aggregate Maturity Score</div>
            <div style={{display:"flex",alignItems:"center",gap:16,marginBottom:12}}>
              <div style={{fontSize:44,fontWeight:800,color:scoreColor(avg),lineHeight:1}}>{avg.toFixed(2)}<span style={{fontSize:18,opacity:.4}}>/4.0</span></div>
              <span className={`badge b${t}`} style={{fontSize:12,padding:"5px 12px"}}>{ti.label}</span>
            </div>
            <div className="dim-grid">
              {dimAvgs.map((d,i)=>{const s=scoreStyle(d.avg);return(
                <div key={i} className="dim-row">
                  <div className="dim-nm">{d.dim}</div>
                  <div className="dim-br"><div className="dim-bg"><div className={`dim-fill ${s.bar}`} style={{width:`${(d.avg/4)*100}%`}}/></div><div className={`dim-val ${s.val}`}>{d.avg.toFixed(2)}</div></div>
                </div>
              );})}
            </div>
          </div>
          {/* Talking points */}
          {!company.isTester&&(
            <div className="msec">
              <div className="msec-title">Consultant Talking Points (Top 3 Gaps)</div>
              <div className="tp-card">
                <div className="tp-title">üéØ Opening conversation angles based on lowest-scoring dimensions</div>
                {gaps.map((g,i)=>(
                  <div key={i} className="tp-item">
                    <div className="tp-num">{i+1}</div>
                    <div className="tp-text"><strong>{g.dim}</strong> (avg {g.avg.toFixed(2)}): {TALKING_POINTS[g.dim]}</div>
                  </div>
                ))}
              </div>
            </div>
          )}
          {/* Individual respondents */}
          <div className="msec">
            <div className="msec-title">Individual Respondents</div>
            <div className="table-wrap">
              <table>
                <thead><tr><th>Name</th><th>Title</th><th>Score</th><th>Tier</th><th>Date</th></tr></thead>
                <tbody>
                  {responses.map((r,i)=>{const sc=parseFloat(r.overallScore)||0,rt=getTier(sc);return(
                    <tr key={i}>
                      <td style={{fontWeight:600}}>{r.fullName}</td>
                      <td style={{fontSize:12,color:"var(--g4)"}}>{r.title}</td>
                      <td><span style={{fontWeight:800,color:scoreColor(sc)}}>{sc.toFixed(1)}</span></td>
                      <td><span className={`badge b${rt}`}>{TIER_INFO[rt].short}</span></td>
                      <td style={{fontSize:12,color:"var(--g4)"}}>{fmtDate(r.timestamp)}</td>
                    </tr>
                  );})}
                </tbody>
              </table>
            </div>
          </div>
          {/* Stated priorities */}
          <div className="msec">
            <div className="msec-title">Stated Top Priorities</div>
            {responses.filter(r=>r.topOutcome).map((r,i)=>(
              <div key={i} style={{background:"var(--g1)",borderRadius:8,padding:"10px 14px",marginBottom:8,borderLeft:"3px solid var(--blue)"}}>
                <div style={{fontSize:11,fontWeight:700,color:"var(--blue)",marginBottom:3}}>{r.fullName} ‚Äî {r.title}</div>
                <div style={{fontSize:13,color:"var(--g5)",fontStyle:"italic"}}>"{r.topOutcome}"</div>
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>
  );
}

/* ‚îÄ‚îÄ‚îÄ RESPONSE DETAIL MODAL ‚îÄ‚îÄ‚îÄ */
function ResponseModal({record,onClose}){
  if(!record)return null;
  const sc=parseFloat(record.overallScore)||0,t=getTier(sc),ti=TIER_INFO[t];
  const dimScores=Object.entries(record).filter(([k])=>k.startsWith("DIM_")).map(([k,v])=>{
    const dim=k.replace("DIM_","").replace(/___/g," & ").replace(/__/g,", ").replace(/_/g," ");
    return{dim,score:parseFloat(v)||0};
  });
  const qScores=Object.entries(record).filter(([k])=>k.startsWith("Q_")).map(([k,v])=>{
    const parts=k.replace("Q_","").split("_");
    return{id:parts[0],domain:parts.slice(1).join(" ").replace(/_/g," "),score:parseInt(v)||0};
  });
  return(
    <div className="modal-overlay" onClick={e=>e.target===e.currentTarget&&onClose()}>
      <div className="modal">
        <div className="modal-hd">
          <div><div className="modal-title">{record.fullName} ‚Äî {record.businessName}</div><div style={{fontSize:13,color:"var(--g4)",marginTop:3}}>{fmtDate(record.timestamp)} ¬∑ {record.industry}</div></div>
          <button className="modal-close" onClick={onClose}>√ó</button>
        </div>
        <div className="modal-body">
          <div className="msec">
            <div className="msec-title">Contact</div>
            <div className="mgrid">
              {[["Name",record.fullName],["Title",record.title],["Email",record.email],["Company",record.businessName],["Industry",record.industry],["Timeline",record.timeline],["Confidence",record.confidence?`${record.confidence}/10`:"‚Äî"],["Domain",record.emailDomain]].map(([k,v])=>(
                <div key={k}><div className="mfl">{k}</div><div className="mfv">{v||"‚Äî"}</div></div>
              ))}
            </div>
          </div>
          {record.topOutcome&&(
            <div className="msec">
              <div className="msec-title">Stated Priority</div>
              <div style={{background:"var(--blue-xlt)",borderRadius:8,padding:"12px 14px",fontSize:14,color:"var(--navy)",fontStyle:"italic"}}>"{record.topOutcome}"</div>
            </div>
          )}
          <div className="msec">
            <div className="msec-title">Maturity Result</div>
            <div style={{display:"flex",alignItems:"center",gap:16,marginBottom:12}}>
              <div style={{fontSize:44,fontWeight:800,color:scoreColor(sc),lineHeight:1}}>{sc.toFixed(1)}<span style={{fontSize:18,opacity:.4}}>/4.0</span></div>
              <span className={`badge b${t}`} style={{fontSize:12,padding:"5px 12px"}}>{ti.label}</span>
            </div>
            <div className="dim-grid">
              {dimScores.map((d,i)=>{const s=scoreStyle(d.score);return(
                <div key={i} className="dim-row">
                  <div className="dim-nm">{d.dim}</div>
                  <div className="dim-br"><div className="dim-bg"><div className={`dim-fill ${s.bar}`} style={{width:`${(d.score/4)*100}%`}}/></div><div className={`dim-val ${s.val}`}>{d.score.toFixed(1)}</div></div>
                </div>
              );})}
            </div>
          </div>
          {qScores.length>0&&(
            <div className="msec">
              <div className="msec-title">Question Scores</div>
              <div className="qs-grid">
                {qScores.map((q,i)=>{const s=scoreStyle(q.score);return(
                  <div key={i} className="qs-row">
                    <div className="qs-lbl">{q.id.toUpperCase()}: {q.domain}</div>
                    <div className={`qs-val ${s.val}`}>{q.score}/4</div>
                  </div>
                );})}
              </div>
            </div>
          )}
        </div>
      </div>
    </div>
  );
}

/* ‚îÄ‚îÄ‚îÄ TRENDS TAB ‚îÄ‚îÄ‚îÄ */
function TrendsTab({data}){
  const real=data.filter(r=>!isTesterDomain(r.emailDomain));
  if(real.length<2)return(<div className="card"><div className="empty"><div className="empty-icon">üìà</div><div className="empty-title">Not enough data yet</div><div className="empty-desc">Trends appear once you have at least 2 customer responses.</div></div></div>);
  const sorted=[...real].sort((a,b)=>new Date(a.timestamp)-new Date(b.timestamp));
  const lineData=sorted.map((r,i)=>{
    const w=sorted.slice(Math.max(0,i-4),i+1);
    return{name:`#${i+1}`,score:parseFloat(r.overallScore)||0,rolling:parseFloat(arrAvg(w.map(x=>parseFloat(x.overallScore)||0)).toFixed(2)),date:fmtDate(r.timestamp)};
  });
  const half=Math.max(1,Math.floor(sorted.length/2));
  const first=sorted.slice(0,half),second=sorted.slice(half);
  const dimTrend=DIMENSIONS.map((d,i)=>{
    const k=DIM_KEYS[i];
    const f=arrAvg(first.map(r=>parseFloat(r[k])||0).filter(v=>v>0));
    const s=arrAvg(second.map(r=>parseFloat(r[k])||0).filter(v=>v>0));
    return{dim:d.length>18?d.substring(0,16)+"‚Ä¶":d,first:parseFloat(f.toFixed(2)),second:parseFloat(s.toFixed(2)),delta:parseFloat((s-f).toFixed(2))};
  });
  return(
    <div>
      <div className="card">
        <div className="card-title">Score Over Time (Rolling 5-Response Average)</div>
        <ResponsiveContainer width="100%" height={260}>
          <LineChart data={lineData} margin={{top:5,right:20,bottom:5,left:-10}}>
            <CartesianGrid strokeDasharray="3 3" stroke="#E5E5E5"/>
            <XAxis dataKey="name" tick={{fontSize:11}}/><YAxis domain={[1,4]} tick={{fontSize:11}}/>
            <Tooltip formatter={(v,n)=>[parseFloat(v).toFixed(2),n==="score"?"Individual":"Rolling Avg"]} labelFormatter={(_,p)=>p[0]?.payload?.date||""}/>
            <Legend/>
            <Line type="monotone" dataKey="score" stroke="#C9C9C9" strokeWidth={1.5} dot={{r:4,fill:"#0176D3"}} name="score"/>
            <Line type="monotone" dataKey="rolling" stroke="#0176D3" strokeWidth={2.5} dot={false} name="rolling"/>
          </LineChart>
        </ResponsiveContainer>
      </div>
      <div className="card">
        <div className="card-title">Dimension Scores: First Half vs Second Half</div>
        <ResponsiveContainer width="100%" height={280}>
          <BarChart data={dimTrend} margin={{top:5,right:20,bottom:55,left:-10}}>
            <CartesianGrid strokeDasharray="3 3" stroke="#E5E5E5"/>
            <XAxis dataKey="dim" tick={{fontSize:10}} angle={-30} textAnchor="end" interval={0}/>
            <YAxis domain={[0,4]} tick={{fontSize:11}}/><Tooltip/><Legend wrapperStyle={{paddingTop:20}}/>
            <Bar dataKey="first" fill="#C9C9C9" radius={[3,3,0,0]} name="First Half"/>
            <Bar dataKey="second" fill="#0176D3" radius={[3,3,0,0]} name="Second Half"/>
          </BarChart>
        </ResponsiveContainer>
        <div style={{marginTop:10,display:"flex",flexWrap:"wrap",gap:7}}>
          {dimTrend.map((d,i)=>{const up=d.delta>0.05,dn=d.delta<-0.05;return(
            <div key={i} style={{fontSize:12,padding:"4px 10px",borderRadius:6,background:up?"var(--green-lt)":dn?"rgba(186,5,23,.07)":"var(--g1)",color:up?"var(--green)":dn?"var(--red)":"var(--g4)",fontWeight:600}}>
              {up?"‚Üë":dn?"‚Üì":"‚Üí"} {d.dim}: {d.delta>0?"+":""}{d.delta}
            </div>
          );})}
        </div>
      </div>
    </div>
  );
}

/* ‚îÄ‚îÄ‚îÄ APP ‚îÄ‚îÄ‚îÄ */
function App(){
  const [authed,setAuthed]=useState(false);
  const [tab,setTab]=useState("overview");
  const [data,setData]=useState(SAMPLE_DATA);
  const [selectedResponse,setSelectedResponse]=useState(null);
  const [selectedCompany,setSelectedCompany]=useState(null);
  const [loading,setLoading]=useState(false);
  const configured=GOOGLE_SHEETS_API!=="https://script.google.com/a/macros/salesforce.com/s/AKfycbx6e8OBmuWhi-4sfJ8dsIoh1dlDZAy7pxkHR_snNxSDhdJQ3VOV0wBCEncpmqkT9fYe/exec";

  useEffect(()=>{
    if(authed&&configured){
      setLoading(true);
      fetch(GOOGLE_SHEETS_API+"?action=getAll")
        .then(r=>r.json()).then(d=>{if(d.data?.length)setData(d.data);})
        .catch(()=>setData(SAMPLE_DATA)).finally(()=>setLoading(false));
    }
  },[authed]);

  if(!authed)return<LoginScreen onLogin={()=>setAuthed(true)}/>;

  const totalCustomers=data.filter(r=>!isTesterDomain(r.emailDomain)).length;
  return(
    <div>
      <nav className="nav">
        <div className="nav-logo"><SFLogo/><div className="nav-div"/><span className="nav-title">Response Analytics Dashboard</span></div>
        <div className="nav-right">
          <span className="nav-count">{totalCustomers} customer responses</span>
          <button className="nav-out" onClick={()=>setAuthed(false)}>Sign Out</button>
        </div>
      </nav>
      <div className="tabs">
        {[["overview","üìä Overview"],["responses","üìã All Responses"],["companies","üè¢ Companies"],["trends","üìà Trends"],["library","üìö Best Practices"]].map(([id,lbl])=>(
          <div key={id} className={`tab ${tab===id?"active":""}`} onClick={()=>setTab(id)}>{lbl}</div>
        ))}
      </div>
      <div className="main">
        <SetupBanner configured={configured}/>
        {loading&&<div style={{textAlign:"center",padding:"40px",color:"var(--g4)"}}>Loading responses‚Ä¶</div>}
        {!loading&&tab==="overview"&&<OverviewTab data={data}/>}
        {!loading&&tab==="responses"&&<ResponsesTab data={data} onSelect={setSelectedResponse}/>}
        {!loading&&tab==="companies"&&<CompaniesTab data={data} onSelectCompany={setSelectedCompany}/>}
        {!loading&&tab==="trends"&&<TrendsTab data={data}/>}
        {!loading&&tab==="library"&&<LibraryTab/>}
      </div>
      {selectedResponse&&<ResponseModal record={selectedResponse} onClose={()=>setSelectedResponse(null)}/>}
      {selectedCompany&&<CompanyModal company={selectedCompany} onClose={()=>setSelectedCompany(null)}/>}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
<!--
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë  ADD THIS doGet() to your existing Apps Script (below doPost):      ‚ïë
‚ïë                                                                      ‚ïë
‚ïë  function doGet(e) {                                                 ‚ïë
‚ïë    if (e.parameter.action === "getAll") {                            ‚ïë
‚ïë      var sheet =                                                     ‚ïë
‚ïë        SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();       ‚ïë
‚ïë      var rows = sheet.getDataRange().getValues();                    ‚ïë
‚ïë      if (rows.length < 2) return ContentService                      ‚ïë
‚ïë        .createTextOutput(JSON.stringify({status:"ok",data:[]}))      ‚ïë
‚ïë        .setMimeType(ContentService.MimeType.JSON);                   ‚ïë
‚ïë      var headers = rows[0];                                          ‚ïë
‚ïë      var data = rows.slice(1).map(function(row) {                   ‚ïë
‚ïë        var obj = {};                                                 ‚ïë
‚ïë        headers.forEach(function(h,i){ obj[h] = row[i]; });          ‚ïë
‚ïë        return obj;                                                   ‚ïë
‚ïë      });                                                             ‚ïë
‚ïë      return ContentService                                           ‚ïë
‚ïë        .createTextOutput(JSON.stringify({status:"ok",data:data}))    ‚ïë
‚ïë        .setMimeType(ContentService.MimeType.JSON);                   ‚ïë
‚ïë    }                                                                 ‚ïë
‚ïë    if (e.parameter.action === "getQuestions") {                      ‚ïë
‚ïë      var sheet =                                                     ‚ïë
‚ïë        SpreadsheetApp.getActiveSpreadsheet()                         ‚ïë
‚ïë          .getSheetByName("Questions");                               ‚ïë
‚ïë      if (!sheet) return ContentService                               ‚ïë
‚ïë        .createTextOutput(JSON.stringify({questions:[]}))             ‚ïë
‚ïë        .setMimeType(ContentService.MimeType.JSON);                   ‚ïë
‚ïë      var data = JSON.parse(sheet.getRange(1,1).getValue());          ‚ïë
‚ïë      return ContentService                                           ‚ïë
‚ïë        .createTextOutput(JSON.stringify({questions:data}))           ‚ïë
‚ïë        .setMimeType(ContentService.MimeType.JSON);                   ‚ïë
‚ïë    }                                                                 ‚ïë
‚ïë  }                                                                   ‚ïë
‚ïë                                                                      ‚ïë
‚ïë  After editing, create a NEW Deployment and update the URL.         ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
-->
</body>
</html>
