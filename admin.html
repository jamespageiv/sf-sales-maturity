<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>B2B Sales Maturity Assessment | Admin</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Sora:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root{--blue:#0176D3;--navy:#032D60;--teal:#06A59A;--green:#2E844A;--red:#BA0517;--orange:#FE5000;--amber:#B8860B;--g1:#F3F3F3;--g2:#E5E5E5;--g4:#706E6B;--g5:#444;--sh:0 2px 12px rgba(0,0,0,.08);}
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:'Sora',sans-serif;background:#F0F4FA;color:var(--g5);min-height:100vh;}
#root{min-height:100vh;}
.login-wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--navy) 0%,#093a6e 60%,#0176D3 100%);}
.login-card{background:#fff;border-radius:16px;padding:48px 44px;width:360px;box-shadow:0 8px 40px rgba(0,0,0,.22);text-align:center;}
.login-title{font-size:20px;font-weight:800;color:var(--navy);margin-bottom:6px;}
.login-sub{font-size:13px;color:var(--g4);margin-bottom:24px;}
.login-input{width:100%;padding:11px 14px;border:1.5px solid var(--g2);border-radius:8px;font-size:14px;font-family:inherit;outline:none;margin-bottom:12px;transition:border-color .2s;}
.login-input:focus{border-color:var(--blue);}
.login-btn{width:100%;padding:12px;background:var(--blue);color:#fff;border:none;border-radius:8px;font-size:15px;font-weight:700;cursor:pointer;font-family:inherit;}
.login-btn:hover{background:var(--navy);}
.login-err{font-size:12px;color:var(--red);margin-bottom:8px;}
.nav{background:var(--navy);padding:0 28px;height:58px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100;}
.nav-left{display:flex;align-items:center;gap:14px;}
.nav-divider{width:1px;height:26px;background:rgba(255,255,255,.2);}
.nav-label{color:rgba(255,255,255,.8);font-size:13px;font-weight:500;}
.nav-out{background:transparent;border:1px solid rgba(255,255,255,.25);color:rgba(255,255,255,.6);padding:5px 14px;border-radius:6px;font-size:12px;cursor:pointer;font-family:inherit;}
.nav-out:hover{background:rgba(255,255,255,.1);color:#fff;}
.tabs{background:#fff;border-bottom:1px solid var(--g2);display:flex;padding:0 28px;gap:2px;overflow-x:auto;}
.tab{padding:14px 18px;font-size:13px;font-weight:600;color:var(--g4);cursor:pointer;border-bottom:3px solid transparent;white-space:nowrap;}
.tab:hover{color:var(--navy);}
.tab.active{color:var(--blue);border-bottom-color:var(--blue);}
.main{max-width:1100px;margin:0 auto;padding:28px 20px 80px;}
.banner{background:#FFF8E1;border:1.5px solid #FFD54F;border-radius:10px;padding:14px 18px;margin-bottom:20px;font-size:13px;color:#6D4C00;}
.stat-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:14px;margin-bottom:22px;}
.stat-card{background:#fff;border-radius:10px;padding:20px;box-shadow:var(--sh);}
.stat-label{font-size:11px;font-weight:700;letter-spacing:.8px;text-transform:uppercase;color:var(--g4);margin-bottom:8px;}
.stat-value{font-size:32px;font-weight:800;color:var(--navy);}
.g2col{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px;}
@media(max-width:800px){.g2col{grid-template-columns:1fr;}}
.card{background:#fff;border-radius:10px;padding:20px;box-shadow:var(--sh);margin-bottom:16px;}
.card-title{font-size:14px;font-weight:700;color:var(--navy);margin-bottom:14px;}
.tier-badge{display:inline-flex;align-items:center;padding:3px 10px;border-radius:20px;font-size:11px;font-weight:700;}
.t1{background:#FDECEA;color:var(--red);}
.t2{background:#FFF3E0;color:var(--orange);}
.t3{background:#FFFDE7;color:var(--amber);}
.t4{background:#E0F7F6;color:var(--teal);}
.tester-badge{background:#EEF4FF;color:var(--blue);font-size:10px;font-weight:700;padding:2px 8px;border-radius:10px;margin-left:6px;}
.hm-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:4px;}
.hm-cell{border-radius:6px;padding:7px 3px;text-align:center;}
.hm-lbl{font-size:9px;font-weight:600;color:var(--g4);line-height:1.2;margin-bottom:3px;}
.hm-val{font-size:13px;font-weight:800;}
table{width:100%;border-collapse:collapse;font-size:13px;}
th{text-align:left;padding:10px 12px;font-size:11px;font-weight:700;letter-spacing:.5px;text-transform:uppercase;color:var(--g4);border-bottom:2px solid var(--g2);}
td{padding:10px 12px;border-bottom:1px solid var(--g1);vertical-align:middle;}
tr:hover td{background:#FAFBFF;}
.filters{display:flex;gap:10px;margin-bottom:16px;flex-wrap:wrap;align-items:center;}
.fi{padding:8px 12px;border:1.5px solid var(--g2);border-radius:8px;font-size:13px;font-family:inherit;outline:none;}
.fi:focus{border-color:var(--blue);}
input.fi{flex:1;min-width:160px;}
.toggle{display:flex;align-items:center;gap:6px;font-size:13px;color:var(--g4);cursor:pointer;white-space:nowrap;}
.co-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:14px;}
.co-card{background:#fff;border-radius:10px;padding:18px;box-shadow:var(--sh);cursor:pointer;border:1.5px solid var(--g2);transition:all .15s;}
.co-card:hover{border-color:var(--blue);transform:translateY(-1px);}
.co-name{font-size:15px;font-weight:700;color:var(--navy);margin-bottom:4px;}
.co-meta{font-size:12px;color:var(--g4);margin-bottom:10px;}
.co-score{font-size:28px;font-weight:800;margin-bottom:6px;}
.modal-bg{position:fixed;inset:0;background:rgba(0,0,0,.45);z-index:200;display:flex;align-items:center;justify-content:center;padding:20px;}
.modal{background:#fff;border-radius:14px;max-width:760px;width:100%;max-height:90vh;overflow-y:auto;box-shadow:0 16px 60px rgba(0,0,0,.25);}
.modal-hd{padding:22px 24px 14px;border-bottom:1px solid var(--g2);display:flex;align-items:center;justify-content:space-between;}
.modal-title{font-size:17px;font-weight:800;color:var(--navy);}
.modal-x{width:30px;height:30px;border-radius:50%;border:none;background:var(--g1);cursor:pointer;font-size:16px;}
.modal-body{padding:22px 24px;}
.tp-box{background:#F0F4FA;border-radius:8px;padding:16px;margin-top:14px;}
.tp-hd{font-size:12px;font-weight:700;letter-spacing:.6px;text-transform:uppercase;color:var(--navy);margin-bottom:10px;}
.tp-row{display:flex;gap:8px;margin-bottom:8px;font-size:13px;line-height:1.55;}
.tp-num{min-width:20px;height:20px;border-radius:50%;background:var(--blue);color:#fff;font-size:10px;font-weight:700;display:flex;align-items:center;justify-content:center;flex-shrink:0;margin-top:2px;}
.lib-section{background:#fff;border-radius:10px;padding:18px;box-shadow:var(--sh);margin-bottom:14px;}
.lib-dim-title{font-size:14px;font-weight:800;color:var(--navy);margin-bottom:12px;padding-bottom:10px;border-bottom:1px solid var(--g2);}
.lib-tiers{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;}
@media(max-width:700px){.lib-tiers{grid-template-columns:1fr 1fr;}}
.lib-tier{border-radius:8px;padding:12px;border:1.5px solid var(--g2);}
.lib-tier-lbl{font-size:10px;font-weight:700;letter-spacing:.6px;text-transform:uppercase;margin-bottom:6px;}
.lib-what{font-size:12px;color:var(--g5);line-height:1.5;margin-bottom:6px;}
.lib-sf{font-size:11px;color:var(--blue);line-height:1.45;margin-bottom:4px;}
.lib-int{font-size:11px;color:var(--green);line-height:1.45;}
.dl-btn{padding:4px 10px;border-radius:6px;font-size:11px;font-weight:600;background:#fff;border:1.5px solid var(--g2);color:var(--g4);cursor:pointer;margin-left:auto;display:inline-flex;align-items:center;gap:4px;}
.dl-btn:hover{border-color:var(--blue);color:var(--blue);}
.chart-hd{display:flex;align-items:center;margin-bottom:10px;}
.chart-lbl{font-size:13px;font-weight:700;color:var(--navy);}
.empty{text-align:center;padding:60px 20px;color:var(--g4);}
.modal-tabs{display:flex;gap:2px;padding:0 24px;border-bottom:1px solid var(--g2);background:#FAFBFF;}
.modal-tab{padding:10px 16px;font-size:12px;font-weight:600;color:var(--g4);cursor:pointer;border-bottom:3px solid transparent;white-space:nowrap;}
.modal-tab:hover{color:var(--navy);}
.modal-tab.on{color:var(--blue);border-bottom-color:var(--blue);}
.q-list{display:flex;flex-direction:column;gap:10px;}
.q-card{background:#FAFBFF;border:1.5px solid var(--g2);border-radius:10px;padding:14px 16px;cursor:pointer;transition:all .15s;}
.q-card:hover{border-color:var(--blue);background:#F0F6FF;}
.q-card.open{border-color:var(--blue);background:#fff;}
.q-domain{font-size:10px;font-weight:700;letter-spacing:.6px;text-transform:uppercase;color:var(--blue);margin-bottom:4px;}
.q-text{font-size:13px;font-weight:600;color:var(--navy);margin-bottom:10px;}
.q-bar-wrap{display:flex;flex-direction:column;gap:5px;}
.q-bar-row{display:flex;align-items:center;gap:8px;}
.q-bar-label{font-size:11px;color:var(--g4);width:24px;text-align:right;flex-shrink:0;font-weight:600;}
.q-bar-track{flex:1;height:18px;background:var(--g1);border-radius:4px;overflow:hidden;position:relative;}
.q-bar-fill{height:100%;border-radius:4px;transition:width .3s;}
.q-bar-count{font-size:10px;font-weight:700;width:20px;flex-shrink:0;}
.q-avg-chip{display:inline-flex;align-items:center;gap:5px;padding:3px 10px;border-radius:12px;font-size:11px;font-weight:700;margin-top:8px;}
.resp-answers{display:flex;flex-direction:column;gap:6px;margin-top:10px;padding-top:10px;border-top:1px solid var(--g2);}
.resp-answer-row{display:flex;gap:8px;align-items:flex-start;font-size:12px;}
.resp-name{font-weight:600;color:var(--navy);min-width:90px;flex-shrink:0;}
.resp-score-dot{width:20px;height:20px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:800;color:white;flex-shrink:0;}
.resp-answer-text{color:var(--g5);line-height:1.4;}
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const {useState,useEffect,useMemo,useRef}=React;

const ADMIN_PASSWORD="Martha314!";
const GOOGLE_SHEETS_API="https://script.google.com/macros/s/AKfycbxNKBVmPFc3OKrio5tMTAtmDhm0HHqvkcEAmF8uahf7aJGhJpBTLYkMfmysAICUAicxFA/exec";
const TESTER_DOMAINS=["salesforce.com"];
const LOGO="data:image/png;base64,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";

const QUESTIONS = [
  { id:"q1", domain:"Growth Strategy",
    text:"How would you rate your organization's overall B2B sales strategy and leadership alignment?",
    answers:[
      "No formal sales strategy; reactive and rep-driven",
      "Sales goals defined but inconsistent cross-functional alignment",
      "Clear strategic objectives tied to pipeline, growth, and retention",
      "Sales strategy is enterprise-aligned and drives cross-functional execution"]},
  { id:"q2", domain:"Sales Process",
    text:"How would you rate your lead management and qualification process?",
    answers:[
      "Inconsistent lead routing; no defined qualification framework",
      "Basic routing and manual qualification",
      "Defined methodology (BANT, MEDDPICC, SPICED) with reporting",
      "AI-assisted scoring, fast response SLAs, and data-driven qualification"]},
  { id:"q3", domain:"CRM & Data",
    text:"How well does your current CRM opportunity structure reflect how your business actually sells?",
    answers:[
      "Poor Fit â€” Transactional Model Only",
      "Partial Fit â€” Adapted but Constrained",
      "Strong Fit â€” Aligned to Sales Motion",
      "Strategic Fit â€” Revenue Architecture Optimized"]},
  { id:"q4", domain:"Sales Process",
    text:"How would you rate your opportunity and pipeline management rigor?",
    answers:[
      "Pipeline visibility is low; close dates and stages are unreliable",
      "Basic stage tracking but inconsistent updates",
      "Clear stage definitions, weekly updates, defined next steps",
      "Predictive scoring, stage health monitoring, AI-guided selling"]},
  { id:"q5", domain:"CRM & Data",
    text:"How would you rate the completeness and usability of your customer data for insights and activation by your sellers?",
    answers:[
      "Fragmented systems; sellers toggle across tools",
      "Partial visibility into account history and performance",
      "Unified view of account, contacts, activity, and revenue",
      "Real-time, AI-enriched insights driving proactive engagement"]},
  { id:"q6", domain:"Forecasting",
    text:"How would you rate your forecasting and performance management discipline?",
    answers:[
      "Forecasts are manual and low-confidence",
      "Basic pipeline rollups; limited predictive insight",
      "Defined forecasting cadence with measurable accuracy",
      "Predictive forecasting with scenario modeling and AI guidance"]},
  { id:"q7", domain:"AI & Automation",
    text:"How would you rate your use of AI, machine learning, or intelligent agents in your sales process?",
    answers:[
      "No AI usage; fully manual processes",
      "Early experimentation with scoring or summaries",
      "AI used in coaching, scoring, or call summaries",
      "Agentic workflows that plan, reason, and take action"]},
  { id:"q8", domain:"CRM & Data",
    text:"How would you rate CRM adoption and data hygiene?",
    answers:[
      "Low trust in CRM data; heavy Excel shadow systems",
      "Moderate usage; required fields often incomplete",
      "Strong adoption; consistent opportunity updates and next steps",
      "CRM is the single source of truth; high behavioral alignment"]},
  { id:"q9", domain:"Enablement",
    text:"How would you rate your ability to scale best practices across your sales organization?",
    answers:[
      "Top performers operate independently; no standardization",
      "Basic playbooks exist but limited enforcement",
      "Defined methodology and enablement programs",
      "Continuous improvement loop driven by analytics and AI"]},
  { id:"q10", domain:"Data & Partnerships",
    text:"How would you rate the role of external partners or 3rd party data in enhancing your sales teams?",
    answers:[
      "No external partnerships",
      "Some 3rd party data available; ad hoc partner collaboration",
      "3rd party data directly impacting lead/deal scoping; defined partnership network",
      "Integrated and automated 3rd party data with a governed partner ecosystem"]},
  { id:"q11", domain:"Operations & Lifecycle",
    text:"How would you rate your ability to manage sales operations and post-sales account management?",
    answers:[
      "Fragmented â€” Sales and post-sales operate in silos with limited visibility or coordination",
      "Basic Alignment â€” Defined handoffs exist, but processes are manual and inconsistently executed",
      "Coordinated â€” Clear ownership, structured handoffs, and shared visibility across sales and account management",
      "Integrated & Proactive â€” Seamless collaboration, shared KPIs, real-time insights, and proactive account growth management"]},
  { id:"q12", domain:"Operations & Lifecycle",
    text:"How would you rate your organization's agility in making real-time updates to pricing rules, approval workflows, sales stages, or account strategies?",
    answers:[
      "IT-dependent; changes are slow",
      "Minor changes can be made by sales ops",
      "Sales and ops can adjust key levers",
      "Business users can fully manage rules, strategies, and sales stages via UI"]},
  { id:"q13", domain:"Growth Strategy",
    text:"Where is incremental profit more likely to come from in your business today?",
    answers:[
      "Primarily from new lead volume",
      "Mostly new leads with limited expansion",
      "Balanced acquisition and account expansion",
      "Primarily from expanding existing accounts"]},
  { id:"q14", domain:"Growth Strategy",
    text:"What is the biggest barrier to generating more revenue today?",
    answers:[
      "Insufficient high-quality new leads",
      "Time lost chasing poor leads",
      "Administrative and internal process burden",
      "Post-sale servicing and order management friction"]},
];


const DIMS=["Growth Strategy","Sales Process & Governance","Forecasting & Pipeline","Pricing & Quote-to-Cash","Enablement & Coaching","Data, CRM & AI","Operations & Lifecycle"];
const TNAMES=["","Ad Hoc","Developing","Defined","Optimized"];
const TCOLORS=["","#BA0517","#FE5000","#B8860B","#06A59A"];
const DSHORT={"Growth Strategy":"Growth","Sales Process & Governance":"Sales Process","Forecasting & Pipeline":"Forecasting","Pricing & Quote-to-Cash":"Pricing/CPQ","Enablement & Coaching":"Enablement","Data, CRM & AI":"Data & AI","Operations & Lifecycle":"Operations"};

const getTier=s=>s>=3.5?4:s>=2.5?3:s>=1.5?2:1;
const tcls=t=>['','t1','t2','t3','t4'][t]||'t1';
const isTester=d=>TESTER_DOMAINS.some(td=>d&&d.toLowerCase().includes(td.toLowerCase()));
const avg=a=>a.length?a.reduce((s,v)=>s+v,0)/a.length:0;
const sc=s=>s>=3.5?'#06A59A':s>=2.5?'#B8860B':s>=1.5?'#FE5000':'#BA0517';
const dk=d=>`DIM_${d.replace(/[^a-zA-Z0-9]/g,'_')}`;
const getDS=(row,dim)=>{const v=parseFloat(row[dk(dim)]);return isNaN(v)?0:v;};

const SAMPLE=[
  {timestamp:"2026-02-01",fullName:"Sarah Chen",email:"sarah@techcorp.com",businessName:"TechCorp",title:"VP Sales",industry:"Technology: Software / SaaS",overallScore:"2.8",overallTier:"Defined",emailDomain:"techcorp.com",isTester:"false",confidence:"7",topOutcome:"Improve forecast accuracy",DIM_Growth_Strategy:"2.5",DIM_Sales_Process___Governance:"3.0",DIM_Forecasting___Pipeline:"2.8",DIM_Pricing___Quote_to_Cash:"2.5",DIM_Enablement___Coaching:"3.2",DIM_Data__CRM___AI:"2.6",DIM_Operations___Lifecycle:"3.0"},
  {timestamp:"2026-02-05",fullName:"James Wilson",email:"jwilson@techcorp.com",businessName:"TechCorp",title:"Sales Ops",industry:"Technology: Software / SaaS",overallScore:"3.1",overallTier:"Defined",emailDomain:"techcorp.com",isTester:"false",confidence:"8",topOutcome:"Reduce time to close",DIM_Growth_Strategy:"3.0",DIM_Sales_Process___Governance:"3.2",DIM_Forecasting___Pipeline:"3.1",DIM_Pricing___Quote_to_Cash:"3.0",DIM_Enablement___Coaching:"3.4",DIM_Data__CRM___AI:"3.0",DIM_Operations___Lifecycle:"3.1"},
  {timestamp:"2026-02-10",fullName:"Mark Rivera",email:"mark@medco.com",businessName:"MedCo",title:"CRO",industry:"Life Sciences & Pharma",overallScore:"1.9",overallTier:"Developing",emailDomain:"medco.com",isTester:"false",confidence:"4",topOutcome:"Get CRM adoption up",DIM_Growth_Strategy:"1.5",DIM_Sales_Process___Governance:"2.0",DIM_Forecasting___Pipeline:"1.8",DIM_Pricing___Quote_to_Cash:"2.0",DIM_Enablement___Coaching:"2.2",DIM_Data__CRM___AI:"1.5",DIM_Operations___Lifecycle:"2.2"},
  {timestamp:"2026-02-14",fullName:"Lisa Park",email:"lisa@finserv.com",businessName:"FinServ Group",title:"Director of Sales",industry:"Financial Services (Banking)",overallScore:"3.6",overallTier:"Optimized",emailDomain:"finserv.com",isTester:"false",confidence:"9",topOutcome:"Build agentic workflows",DIM_Growth_Strategy:"3.8",DIM_Sales_Process___Governance:"3.5",DIM_Forecasting___Pipeline:"3.7",DIM_Pricing___Quote_to_Cash:"3.5",DIM_Enablement___Coaching:"3.6",DIM_Data__CRM___AI:"3.8",DIM_Operations___Lifecycle:"3.5"},
  {timestamp:"2026-02-18",fullName:"Tom Brady",email:"tom@salesforce.com",businessName:"Salesforce",title:"AE",industry:"Technology: Software / SaaS",overallScore:"3.9",overallTier:"Optimized",emailDomain:"salesforce.com",isTester:"true",confidence:"10",topOutcome:"Test the tool",DIM_Growth_Strategy:"4.0",DIM_Sales_Process___Governance:"3.8",DIM_Forecasting___Pipeline:"3.9",DIM_Pricing___Quote_to_Cash:"3.8",DIM_Enablement___Coaching:"4.0",DIM_Data__CRM___AI:"4.0",DIM_Operations___Lifecycle:"3.8"},
  {timestamp:"2026-02-20",fullName:"Anna Lee",email:"anna@retailco.com",businessName:"RetailCo",title:"VP RevOps",industry:"Retail",overallScore:"2.3",overallTier:"Developing",emailDomain:"retailco.com",isTester:"false",confidence:"5",topOutcome:"Better pipeline health",DIM_Growth_Strategy:"2.2",DIM_Sales_Process___Governance:"2.5",DIM_Forecasting___Pipeline:"2.0",DIM_Pricing___Quote_to_Cash:"2.5",DIM_Enablement___Coaching:"2.3",DIM_Data__CRM___AI:"2.1",DIM_Operations___Lifecycle:"2.5"},
];

const TP={"Growth Strategy":"Their growth motion appears primarily new-logo focused with limited expansion infrastructure. Ask what a 10% lift in retention and expansion would mean for margin vs. the same investment in net-new pipeline.","Sales Process & Governance":"Sales stage discipline and qualification rigor are inconsistently applied. Open a conversation around what it costs when deals slip late â€” and what enforced exit criteria could do for forecast confidence.","Forecasting & Pipeline":"Forecast accuracy is low and largely judgment-based. Ask how often leadership adjusts the number before the board call â€” and what it would mean to submit a forecast they actually believed.","Pricing & Quote-to-Cash":"Pricing governance is weak and discounting is largely unchecked. Explore what margin leakage looks like and whether they can quantify what ad-hoc approvals are costing them.","Enablement & Coaching":"Coaching is sporadic and not tied to skill or outcome data. Ask what ramp time looks like for new hires and whether top performers have anything in common that can be systematized.","Data, CRM & AI":"CRM trust and data quality are barriers to any intelligent tooling. Ask how often leadership makes decisions from Salesforce vs. spreadsheets â€” that gap is the real cost.","Operations & Lifecycle":"Post-sale handoffs are fragmented and account health is reactive. Explore what percentage of expansion opportunities are being missed due to lack of visibility into customer health."};

const BP={"Growth Strategy":[{tier:1,what:"Growth is reactive â€” new lead volume is the only lever",sf:"No expansion pipeline; renewal/upsell not tracked",int:"Define expansion plays and account segmentation model"},{tier:2,what:"Some segmentation exists but expansion is informal",sf:"Opportunity types defined; inconsistent expansion pipeline",int:"Build a formal renewal and upsell motion with dedicated pipeline"},{tier:3,what:"Defined ICP, segmentation model, and expansion KPIs",sf:"Account tiers, expansion pipeline, renewal forecasting in CRM",int:"Instrument expansion metrics and tie to territory planning"},{tier:4,what:"Systematic acquisition and expansion with AI-assisted signals",sf:"Agentforce signals for expansion triggers; automated renewal workflows",int:"Deploy intelligent agents to surface expansion timing and risk"}],"Sales Process & Governance":[{tier:1,what:"No common process â€” each rep operates independently",sf:"CRM used as a log; no required fields or stage discipline",int:"Define and enforce stage exit criteria and required fields"},{tier:2,what:"Stages exist but inconsistently applied",sf:"Path to Purchase not fully adopted; some required fields",int:"Implement Salesforce Path with exit criteria and coaching nudges"},{tier:3,what:"Enforced qualification methodology with pipeline discipline",sf:"Path enforced, MEDDPICC fields, stage conversion tracked",int:"Connect qualification scores to forecast and coaching workflows"},{tier:4,what:"AI-assisted qualification and dynamic process optimization",sf:"Einstein Opportunity Scoring; In-App Guidance",int:"Use AI signals to flag off-process deals and coaching opportunities"}],"Forecasting & Pipeline":[{tier:1,what:"Gut-feel forecasting with no consistent methodology",sf:"No forecast categories used; pipeline data unreliable",int:"Introduce forecast categories and a weekly pipeline review cadence"},{tier:2,what:"Manager judgment with basic categories; inconsistent accuracy",sf:"Forecast categories in use; limited tracking vs. target",int:"Build a forecast accuracy dashboard and manager accountability process"},{tier:3,what:"Criteria-based forecasting with tracked accuracy over time",sf:"Forecast rollups, pipeline coverage KPIs, accuracy history",int:"Introduce scenario modeling and tie forecast to capacity planning"},{tier:4,what:"AI-assisted forecasting with high confidence and scenario modeling",sf:"Einstein Forecasting; pipeline health AI; automated early warnings",int:"Deploy predictive forecasting and automated pipeline intervention triggers"}],"Pricing & Quote-to-Cash":[{tier:1,what:"Ad hoc pricing â€” reps discount freely with no governance",sf:"No CPQ; approvals via email; no margin visibility",int:"Establish a pricing policy and basic approval workflow"},{tier:2,what:"Informal guidelines exist; exceptions are common",sf:"Basic approval rules; limited CPQ adoption",int:"Implement CPQ with approval tiers and discount thresholds"},{tier:3,what:"CPQ-enforced pricing with approval workflows and margin tracking",sf:"Salesforce CPQ with deal-level margin visibility",int:"Connect CPQ data to forecasting and deal desk analytics"},{tier:4,what:"Dynamic pricing with full quote-to-cash integration",sf:"Advanced Approvals, ERP integration, margin leakage analytics",int:"Automate renewal quoting and cross-sell bundles using CPQ"}],"Enablement & Coaching":[{tier:1,what:"No playbooks â€” reps create their own approaches",sf:"No CRM-embedded guidance; inconsistent messaging",int:"Document winning plays and build onboarding foundations"},{tier:2,what:"Some documents exist but not consistently used",sf:"Basic resource library; ad hoc coaching",int:"Embed playbooks in Salesforce with In-App Guidance"},{tier:3,what:"Structured coaching tied to skills development and pipeline",sf:"In-App Guidance, coaching scorecards, playbook metrics",int:"Connect coaching data to win rates and ramp time measurement"},{tier:4,what:"AI-powered coaching tied to outcomes and continuous optimization",sf:"Einstein Call Coaching; skill-to-outcome analytics",int:"Deploy conversation intelligence and automated coaching triggers"}],"Data, CRM & AI":[{tier:1,what:"Low CRM trust; Excel shadow systems are the norm",sf:"Missing required fields; no data governance",int:"Establish data governance, duplicate rules, and required field standards"},{tier:2,what:"Moderate adoption; data quality inconsistent",sf:"Some required fields; partial adoption of standard reports",int:"Run a data quality initiative; align team on CRM as system of record"},{tier:3,what:"CRM is system of record with clean, trusted data",sf:"Automated capture, shared dashboards, governance in place",int:"Build shared metric definitions and introduce predictive scoring"},{tier:4,what:"CRM as AI-ready foundation for intelligent automation",sf:"Einstein AI; clean data enabling Agentforce deployment",int:"Deploy Agentforce agents grounded in reliable CRM data"}],"Operations & Lifecycle":[{tier:1,what:"Sales and post-sales operate in silos",sf:"No shared handoff process; no CS visibility in CRM",int:"Define structured handoff artifacts and shared CRM access"},{tier:2,what:"Basic handoff defined but manually executed",sf:"Onboarding milestones partially tracked",int:"Build a formal onboarding and handoff process in Salesforce"},{tier:3,what:"Coordinated lifecycle with shared KPIs and account health",sf:"Health scores, onboarding milestones, proactive CS workflows",int:"Instrument account health metrics and connect to expansion triggers"},{tier:4,what:"Proactive lifecycle management with AI-assisted signals",sf:"Agentforce health monitoring; automated intervention playbooks",int:"Deploy intelligent account monitoring with automated risk alerts"}]};

/* PNG DOWNLOAD */
const dlPNG=(ref,name)=>{
  if(!ref.current)return;
  const s=ref.current;
  const b=s.getBoundingClientRect();
  const w=b.width||600,h=b.height||400;
  const c=document.createElement('canvas');
  c.width=w*2;c.height=h*2;
  const ctx=c.getContext('2d');
  ctx.scale(2,2);ctx.fillStyle='#fff';ctx.fillRect(0,0,w,h);
  const ser=new XMLSerializer();
  const str=ser.serializeToString(s);
  const blob=new Blob([str],{type:'image/svg+xml'});
  const url=URL.createObjectURL(blob);
  const img=new Image();
  img.onload=()=>{ctx.drawImage(img,0,0);URL.revokeObjectURL(url);const a=document.createElement('a');a.download=name+'.png';a.href=c.toDataURL('image/png');a.click();};
  img.src=url;
};
const DlBtn=({r,n})=><button className="dl-btn" onClick={()=>dlPNG(r,n)}>â¬‡ PNG</button>;

/* SVG CHARTS */
const Radar=({scores,title})=>{
  const ref=useRef();
  const dims=Object.keys(scores);
  if(!dims.length)return null;
  const cx=200,cy=195,r=130,n=dims.length,step=(2*Math.PI)/n;
  const pt=(v,i,mx=4)=>{const a=i*step-Math.PI/2,rr=(v/mx)*r;return{x:cx+rr*Math.cos(a),y:cy+rr*Math.sin(a)};};
  const grid=[1,2,3,4].map(lv=>dims.map((_,i)=>pt(lv,i)).map(p=>`${p.x},${p.y}`).join(' '));
  const dp=dims.map((d,i)=>pt(scores[d]||0,i));
  const poly=dp.map(p=>`${p.x},${p.y}`).join(' ');
  const sc2=s=>s<1.75?'#BA0517':s<2.5?'#FE5000':s<3.25?'#B8860B':'#06A59A';
  return(<div><div className="chart-hd">{title&&<span className="chart-lbl">{title}</span>}<DlBtn r={ref} n={title||'radar'}/></div>
    <svg ref={ref} width="400" height="390" viewBox="0 0 400 390" style={{maxWidth:'100%',background:'#fff'}}>
      <rect width="400" height="390" fill="white"/>
      {grid.map((pts,li)=><polygon key={li} points={pts} fill="none" stroke="#E5E5E5" strokeWidth="1"/>)}
      {dims.map((_,i)=>{const p=pt(4,i);return<line key={i} x1={cx} y1={cy} x2={p.x} y2={p.y} stroke="#E5E5E5" strokeWidth="1.5"/>;  })}
      <polygon points={poly} fill="#0176D3" fillOpacity="0.13" stroke="#0176D3" strokeWidth="2.5"/>
      {dp.map((p,i)=><circle key={i} cx={p.x} cy={p.y} r="5" fill="#0176D3" stroke="white" strokeWidth="2"/>)}
      {dims.map((d,i)=>{const lp=pt(4.9,i);const s=scores[d]||0;const anchor=lp.x<cx-15?'end':lp.x>cx+15?'start':'middle';return(<g key={i}><text x={lp.x} y={lp.y-4} textAnchor={anchor} fontSize="10" fontWeight="700" fill="#032D60" fontFamily="sans-serif">{d.substring(0,13)}</text><text x={lp.x} y={lp.y+12} textAnchor={anchor} fontSize="11" fontWeight="800" fill={sc2(s)} fontFamily="sans-serif">{s.toFixed?s.toFixed(1):s}</text></g>);})}
      <circle cx={cx} cy={cy} r="3" fill="#E5E5E5"/>
    </svg></div>);
};

const HBar=({data,vk,lk,colorFn,title,maxV})=>{
  const ref=useRef();
  const mx=maxV||Math.max(...data.map(d=>d[vk]||0),1);
  const bH=26,gap=8,lW=150,cW=330,pT=8;
  const H=pT+data.length*(bH+gap)+10;
  return(<div><div className="chart-hd">{title&&<span className="chart-lbl">{title}</span>}<DlBtn r={ref} n={title||'bar'}/></div>
    <svg ref={ref} width={lW+cW+50} height={H} style={{maxWidth:'100%',background:'#fff'}}>
      <rect width={lW+cW+50} height={H} fill="white"/>
      {data.map((item,i)=>{const y=pT+i*(bH+gap);const val=item[vk]||0;const bw=Math.max((val/mx)*(cW-10),val>0?3:0);const color=colorFn?colorFn(item,i):'#0176D3';const lbl=String(item[lk]||'');return(<g key={i}><text x={lW-6} y={y+bH/2+4} textAnchor="end" fontSize="11" fontWeight="600" fill="#444" fontFamily="sans-serif">{lbl.length>20?lbl.substring(0,18)+'â€¦':lbl}</text><rect x={lW} y={y} width={cW-10} height={bH} fill="#F3F3F3" rx="3"/>{bw>0&&<rect x={lW} y={y} width={bw} height={bH} fill={color} rx="3"/>}{val>0&&<text x={lW+bw+5} y={y+bH/2+4} fontSize="11" fontWeight="700" fill={color} fontFamily="sans-serif">{typeof val==='number'?(Number.isInteger(val)?val:val.toFixed(2)):''}</text>}</g>);})}
    </svg></div>);
};

const LineC=({data,xk,yk,title})=>{
  const ref=useRef();
  if(!data.length)return null;
  const W=520,H=200,pL=40,pR=20,pT=15,pB=35,cW=W-pL-pR,cH=H-pT-pB;
  const xs=i=>pL+(i/(data.length-1||1))*cW;
  const ys=v=>pT+cH-((v-1)/3)*cH;
  const pts=data.map((d,i)=>`${xs(i)},${ys(d[yk]||0)}`).join(' ');
  return(<div><div className="chart-hd">{title&&<span className="chart-lbl">{title}</span>}<DlBtn r={ref} n={title||'line'}/></div>
    <svg ref={ref} width={W} height={H} style={{maxWidth:'100%',background:'#fff'}}>
      <rect width={W} height={H} fill="white"/>
      {[1,2,3,4].map(v=>(<g key={v}><line x1={pL} y1={ys(v)} x2={W-pR} y2={ys(v)} stroke="#E5E5E5" strokeWidth="1" strokeDasharray="4,3"/><text x={pL-5} y={ys(v)+4} textAnchor="end" fontSize="10" fill="#706E6B" fontFamily="sans-serif">{v}</text></g>))}
      {data.map((d,i)=>(<text key={i} x={xs(i)} y={H-8} textAnchor="middle" fontSize="9" fill="#706E6B" fontFamily="sans-serif">{d[xk]||`#${i+1}`}</text>))}
      <polyline points={pts} fill="none" stroke="#0176D3" strokeWidth="2.5"/>
      {data.map((d,i)=>(<circle key={i} cx={xs(i)} cy={ys(d[yk]||0)} r="4" fill="#0176D3" stroke="white" strokeWidth="1.5"/>))}
    </svg></div>);
};

const GBar=({data,keys,colors,title})=>{
  const ref=useRef();
  if(!data.length)return null;
  const bW=20,bG=3,gG=14,pL=35,pB=65,pT=15,H=220,cH=H-pT-pB;
  const gW=keys.length*(bW+bG)+gG;
  const W=Math.max(data.length*gW+pL+20,400);
  const mx=Math.max(...data.flatMap(d=>keys.map(k=>d[k]||0)),4);
  const ys=v=>pT+cH-(v/mx)*cH;
  return(<div style={{overflowX:'auto'}}><div className="chart-hd">{title&&<span className="chart-lbl">{title}</span>}<DlBtn r={ref} n={title||'grouped'}/></div>
    <svg ref={ref} width={W} height={H} style={{background:'#fff'}}>
      <rect width={W} height={H} fill="white"/>
      {[1,2,3,4].map(v=>(<g key={v}><line x1={pL} y1={ys(v)} x2={W-10} y2={ys(v)} stroke="#E5E5E5" strokeWidth="1" strokeDasharray="3,3"/><text x={pL-4} y={ys(v)+4} textAnchor="end" fontSize="10" fill="#706E6B" fontFamily="sans-serif">{v}</text></g>))}
      {data.map((d,di)=>{const gx=pL+di*gW;return(<g key={di}>{keys.map((k,ki)=>{const x=gx+ki*(bW+bG);const val=d[k]||0;const bH=Math.max((val/mx)*cH,val>0?2:0);return<rect key={k} x={x} y={ys(val)} width={bW} height={bH} fill={colors[ki]||'#0176D3'} rx="2"/>;})}<text x={gx+keys.length*(bW+bG)/2} y={H-pB+14} textAnchor="middle" fontSize="9" fill="#706E6B" fontFamily="sans-serif">{(d.dim||'').substring(0,9)}</text></g>);})}
      {keys.map((k,i)=>(<g key={k}><rect x={pL+i*90} y={H-16} width="10" height="10" fill={colors[i]} rx="2"/><text x={pL+i*90+14} y={H-7} fontSize="10" fill="#444" fontFamily="sans-serif">{k}</text></g>))}
    </svg></div>);
};

const ConfC=({data,title})=>{
  const ref=useRef();
  const mx=Math.max(...data.map(d=>d.count||0),1);
  const bW=30,gap=5,pL=18,pT=15,pB=28,H=160,cH=H-pT-pB;
  const W=pL+data.length*(bW+gap)+20;
  return(<div><div className="chart-hd">{title&&<span className="chart-lbl">{title}</span>}<DlBtn r={ref} n={title||'conf'}/></div>
    <svg ref={ref} width={W} height={H} style={{maxWidth:'100%',background:'#fff'}}>
      <rect width={W} height={H} fill="white"/>
      {data.map((d,i)=>{const x=pL+i*(bW+gap);const bH=Math.max((d.count/mx)*cH,d.count>0?3:0);const y=pT+cH-bH;return(<g key={i}><rect x={x} y={y} width={bW} height={bH} fill="#0176D3" rx="2"/>{d.count>0&&<text x={x+bW/2} y={y-3} textAnchor="middle" fontSize="10" fontWeight="700" fill="#0176D3" fontFamily="sans-serif">{d.count}</text>}<text x={x+bW/2} y={H-8} textAnchor="middle" fontSize="10" fill="#706E6B" fontFamily="sans-serif">{d.name}</text></g>);})}
    </svg></div>);
};

/* HEATMAP */
const HM=({row})=>{
  const clrs={4:'#E0F7F6',3:'#FFF9C4',2:'#FFE8CC',1:'#FDECEA'};
  const tclrs={4:'#06A59A',3:'#B8860B',2:'#FE5000',1:'#BA0517'};
  return(<div className="hm-grid">{DIMS.map(d=>{const s=getDS(row,d);const t=getTier(s);return(<div key={d} className="hm-cell" style={{background:clrs[t]||clrs[1]}}><div className="hm-lbl">{DSHORT[d]||d}</div><div className="hm-val" style={{color:tclrs[t]||tclrs[1]}}>{s?s.toFixed(1):'-'}</div></div>);})}</div>);
};

/* TALKING POINTS */
const TalkPts=({rows})=>{
  if(!rows.length)return null;
  const low=[...DIMS.map(d=>({dim:d,av:avg(rows.map(r=>getDS(r,d)).filter(Boolean))}))].sort((a,b)=>a.av-b.av).slice(0,3);
  return(<div className="tp-box"><div className="tp-hd">ðŸ’¬ Consultant Talking Points</div>{low.map((l,i)=>(<div key={l.dim} className="tp-row"><div className="tp-num">{i+1}</div><div><strong>{l.dim}</strong> (avg {l.av.toFixed(1)}): {TP[l.dim]||'Explore current state and gaps.'}</div></div>))}</div>);
};

/* MODALS */
const RespModal=({r,onClose})=>(
  <div className="modal-bg" onClick={e=>e.target===e.currentTarget&&onClose()}>
    <div className="modal">
      <div className="modal-hd"><div className="modal-title">{r.fullName} â€” {r.businessName}</div><button className="modal-x" onClick={onClose}>âœ•</button></div>
      <div className="modal-body">
        <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:14,marginBottom:16}}>
          {[['Email',r.email],['Title',r.title],['Industry',r.industry],['Submitted',r.timestamp]].map(([l,v])=>(<div key={l}><div style={{fontSize:11,fontWeight:700,color:'#706E6B',marginBottom:2}}>{l}</div><div style={{fontSize:13}}>{v||'â€”'}</div></div>))}
        </div>
        <div style={{display:'flex',gap:10,alignItems:'center',marginBottom:14}}>
          <div style={{fontSize:32,fontWeight:800,color:sc(parseFloat(r.overallScore))}}>{parseFloat(r.overallScore).toFixed(2)}</div>
          <div className={`tier-badge ${tcls(getTier(parseFloat(r.overallScore)))}`}>{TNAMES[getTier(parseFloat(r.overallScore))]}</div>
          {r.confidence&&<div style={{fontSize:13,color:'#706E6B'}}>Confidence: {r.confidence}/10</div>}
        </div>
        <HM row={r}/>
        {r.topOutcome&&<div style={{marginTop:14,padding:'10px 14px',background:'#F0F4FA',borderRadius:8,fontSize:13}}><strong>Top Outcome:</strong> {r.topOutcome}</div>}
      </div>
    </div>
  </div>
);

const CoModal=({co,onClose})=>{
  const rows=co.rows||[];
  const [tab,setTab]=useState('overview');
  const [openQ,setOpenQ]=useState(null);
  const aggRow=Object.fromEntries(DIMS.map(d=>[dk(d),avg(rows.map(r=>getDS(r,d)))]));

  // Get answer text for a row+question
  const getAnswerText=(row,q)=>{
    const score=parseInt(row[`Q_${q.id}_${(q.domain||'').replace(/\s+/g,'_')}`])||0;
    if(!score)return null;
    return{score,text:q.answers?.[score-1]||`Score: ${score}`};
  };

  // Question score distribution for a question across all rows
  const qDist=(q)=>{
    const counts=[0,0,0,0];
    rows.forEach(r=>{
      const s=parseInt(r[`Q_${q.id}_${(q.domain||'').replace(/\s+/g,'_')}`])||0;
      if(s>=1&&s<=4)counts[s-1]++;
    });
    const total=counts.reduce((a,b)=>a+b,0);
    const wavg=total?counts.reduce((s,cnt,i)=>s+cnt*(i+1),0)/total:0;
    return{counts,total,avg:wavg};
  };

  const barColor=s=>s>=3.5?'#06A59A':s>=2.5?'#B8860B':s>=1.5?'#FE5000':'#BA0517';

  return(<div className="modal-bg" onClick={e=>e.target===e.currentTarget&&onClose()}>
    <div className="modal" style={{maxWidth:820}}>
      <div className="modal-hd">
        <div>
          <div className="modal-title">{co.isTester?'ðŸ§ª Testers':co.domain}</div>
          <div style={{fontSize:12,color:'var(--g4)',marginTop:2}}>{rows.length} respondent{rows.length!==1?'s':''} Â· Avg {co.av.toFixed(2)} Â· {TNAMES[getTier(co.av)]}</div>
        </div>
        <button className="modal-x" onClick={onClose}>âœ•</button>
      </div>
      <div className="modal-tabs">
        {[['overview','ðŸ“Š Overview'],['questions','â“ Question Responses'],['respondents','ðŸ‘¥ Respondents']].map(([id,lbl])=>(
          <div key={id} className={`modal-tab ${tab===id?'on':''}`} onClick={()=>setTab(id)}>{lbl}</div>
        ))}
      </div>
      <div className="modal-body">

        {tab==='overview'&&(<div>
          <div style={{display:'flex',gap:10,alignItems:'center',marginBottom:16}}>
            <div style={{fontSize:36,fontWeight:800,color:sc(co.av)}}>{co.av.toFixed(2)}</div>
            <div className={`tier-badge ${tcls(getTier(co.av))}`}>{TNAMES[getTier(co.av)]}</div>
          </div>
          <HM row={aggRow}/>
          <TalkPts rows={rows}/>
        </div>)}

        {tab==='questions'&&(<div>
          <p style={{fontSize:13,color:'var(--g4)',marginBottom:14}}>Click any question to see how each respondent answered.</p>
          <div className="q-list">
            {(typeof QUESTIONS!=='undefined'?QUESTIONS:[]).map((q,qi)=>{
              const dist=qDist(q);
              const isOpen=openQ===q.id;
              const maxCount=Math.max(...dist.counts,1);
              return(
                <div key={q.id} className={`q-card ${isOpen?'open':''}`} onClick={()=>setOpenQ(isOpen?null:q.id)}>
                  <div className="q-domain">{q.domain}</div>
                  <div className="q-text">{q.text}</div>
                  {dist.total>0?(
                    <div>
                      <div className="q-bar-wrap">
                        {[1,2,3,4].map(score=>(
                          <div key={score} className="q-bar-row">
                            <div className="q-bar-label">{score}</div>
                            <div className="q-bar-track">
                              <div className="q-bar-fill" style={{width:`${(dist.counts[score-1]/maxCount)*100}%`,background:barColor(score)}}/>
                            </div>
                            <div className="q-bar-count" style={{color:barColor(score)}}>{dist.counts[score-1]||''}</div>
                          </div>
                        ))}
                      </div>
                      <div className={`q-avg-chip ${tcls(getTier(dist.avg))}`} style={{background:'var(--g1)'}}>
                        Avg {dist.avg.toFixed(1)} Â· {TNAMES[getTier(dist.avg)]}
                      </div>
                    </div>
                  ):<div style={{fontSize:12,color:'var(--g4)',fontStyle:'italic'}}>No responses recorded for this question.</div>}

                  {isOpen&&dist.total>0&&(
                    <div className="resp-answers">
                      <div style={{fontSize:11,fontWeight:700,color:'var(--navy)',letterSpacing:'.5px',textTransform:'uppercase',marginBottom:4}}>Individual Responses</div>
                      {rows.map((row,ri)=>{
                        const ans=getAnswerText(row,q);
                        if(!ans)return null;
                        return(
                          <div key={ri} className="resp-answer-row">
                            <div className="resp-name">{row.fullName?.split(' ')[0]||'Resp '+(ri+1)}</div>
                            <div className="resp-score-dot" style={{background:barColor(ans.score)}}>{ans.score}</div>
                            <div className="resp-answer-text">{ans.text}</div>
                          </div>
                        );
                      })}
                    </div>
                  )}
                </div>
              );
            })}
          </div>
        </div>)}

        {tab==='respondents'&&(<div>
          {rows.map((r,i)=>(
            <div key={i} style={{display:'flex',gap:12,alignItems:'center',padding:'10px 0',borderBottom:'1px solid var(--g1)'}}>
              <div style={{flex:1}}>
                <div style={{fontSize:13,fontWeight:700}}>{r.fullName}</div>
                <div style={{fontSize:12,color:'var(--g4)'}}>{r.title} Â· {r.email}</div>
              </div>
              <div style={{textAlign:'right'}}>
                <div style={{fontSize:18,fontWeight:800,color:sc(parseFloat(r.overallScore))}}>{parseFloat(r.overallScore).toFixed(2)}</div>
                <div className={`tier-badge ${tcls(getTier(parseFloat(r.overallScore)))}`}>{TNAMES[getTier(parseFloat(r.overallScore))]}</div>
              </div>
            </div>
          ))}
        </div>)}

      </div>
    </div>
  </div>);
};


/* â•â•â• CSV EXPORT â•â•â• */
const downloadCSV=(data)=>{
  if(!data.length)return;
  const keys=Object.keys(data[0]);
  const escape=(v)=>{
    const s=String(v??'');
    return s.includes(',')||s.includes('"')||s.includes('\n')?`"${s.replace(/"/g,'""')}"`:s;
  };
  const rows=[keys.join(','),...data.map(r=>keys.map(k=>escape(r[k])).join(','))];
  const blob=new Blob([rows.join('\n')],{type:'text/csv'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');
  a.href=url;
  a.download=`b2b-sales-maturity-responses-${new Date().toISOString().slice(0,10)}.csv`;
  a.click();
  URL.revokeObjectURL(url);
};

/* OVERVIEW TAB */
function OverviewTab({data}){
  const real=data.filter(r=>!isTester(r.emailDomain));
  const scores=real.map(r=>parseFloat(r.overallScore)||0);
  const avgS=avg(scores);
  const tc={1:0,2:0,3:0,4:0};real.forEach(r=>{tc[getTier(parseFloat(r.overallScore)||0)]++;});
  const domT=Object.entries(tc).sort((a,b)=>b[1]-a[1])[0];
  const cos=new Set(real.map(r=>r.emailDomain).filter(Boolean));
  const dimAvgs=DIMS.map(d=>({dim:DSHORT[d]||d,av:parseFloat(avg(real.map(r=>getDS(r,d))).toFixed(2))}));
  const tierD=[1,2,3,4].map(t=>({name:TNAMES[t],count:tc[t]}));
  const confD=Array.from({length:10},(_,i)=>({name:String(i+1),count:real.filter(r=>parseInt(r.confidence)===i+1).length}));
  const sorted=[...real].sort((a,b)=>new Date(a.timestamp)-new Date(b.timestamp));
  const lineD=sorted.map((r,i)=>({name:`#${i+1}`,score:parseFloat(r.overallScore)||0}));
  const half=Math.floor(real.length/2);
  const h1=real.slice(0,half),h2=real.slice(half);
  const dimT=DIMS.map(d=>({dim:DSHORT[d]||d,first:parseFloat(avg(h1.map(r=>getDS(r,d))).toFixed(2)),second:parseFloat(avg(h2.map(r=>getDS(r,d))).toFixed(2))}));
  return(<div>
    <div className="stat-grid">
      <div className="stat-card"><div className="stat-label">Customer Responses</div><div className="stat-value">{real.length}</div></div>
      <div className="stat-card"><div className="stat-label">Avg Maturity Score</div><div className="stat-value" style={{color:sc(avgS)}}>{avgS.toFixed(2)}</div></div>
      <div className="stat-card"><div className="stat-label">Dominant Tier</div><div style={{marginTop:8}}><span className={`tier-badge ${tcls(parseInt(domT?.[0]))}`}>{TNAMES[parseInt(domT?.[0])]}</span></div></div>
      <div className="stat-card"><div className="stat-label">Unique Companies</div><div className="stat-value">{cos.size}</div></div>
    </div>
    <div className="g2col">
      <div className="card"><HBar data={tierD} vk="count" lk="name" title="Tier Distribution" colorFn={(_,i)=>TCOLORS[i+1]} maxV={Math.max(...tierD.map(d=>d.count),1)}/></div>
      <div className="card"><Radar scores={Object.fromEntries(dimAvgs.map(d=>[d.dim,d.av]))} title="Avg Maturity by Dimension"/></div>
    </div>
    <div className="g2col">
      <div className="card"><HBar data={dimAvgs} vk="av" lk="dim" title="Avg Score by Dimension" colorFn={(item)=>sc(item.av)} maxV={4}/></div>
      <div className="card"><ConfC data={confD} title="Confidence Distribution"/></div>
    </div>
    <div className="card"><LineC data={lineD} xk="name" yk="score" title="Score Over Time"/></div>
    <div className="card"><GBar data={dimT} keys={["first","second"]} colors={["#C9C9C9","#0176D3"]} title="Dimension Scores: First Half vs Second Half"/></div>
  </div>);
}

/* ALL RESPONSES TAB */
function AllResponsesTab({data}){
  const [search,setSearch]=useState('');
  const [tier,setTier]=useState('all');
  const [sort,setSort]=useState('newest');
  const [showT,setShowT]=useState(false);
  const [sel,setSel]=useState(null);
  const filtered=useMemo(()=>{
    let rows=data;
    if(!showT)rows=rows.filter(r=>!isTester(r.emailDomain));
    if(tier!=='all')rows=rows.filter(r=>r.overallTier===tier);
    if(search)rows=rows.filter(r=>(r.fullName+r.businessName+r.email+r.industry).toLowerCase().includes(search.toLowerCase()));
    if(sort==='newest')rows=[...rows].sort((a,b)=>new Date(b.timestamp)-new Date(a.timestamp));
    else if(sort==='oldest')rows=[...rows].sort((a,b)=>new Date(a.timestamp)-new Date(b.timestamp));
    else if(sort==='high')rows=[...rows].sort((a,b)=>(parseFloat(b.overallScore)||0)-(parseFloat(a.overallScore)||0));
    else rows=[...rows].sort((a,b)=>(parseFloat(a.overallScore)||0)-(parseFloat(b.overallScore)||0));
    return rows;
  },[data,search,tier,sort,showT]);
  return(<div>
    <div className="filters">
      <input className="fi" placeholder="Search name, company, industryâ€¦" value={search} onChange={e=>setSearch(e.target.value)}/>
      <select className="fi" value={tier} onChange={e=>setTier(e.target.value)}><option value="all">All Tiers</option>{['Ad Hoc','Developing','Defined','Optimized'].map(t=><option key={t}>{t}</option>)}</select>
      <select className="fi" value={sort} onChange={e=>setSort(e.target.value)}><option value="newest">Newest First</option><option value="oldest">Oldest First</option><option value="high">Highest Score</option><option value="low">Lowest Score</option></select>
      <label className="toggle"><input type="checkbox" checked={showT} onChange={e=>setShowT(e.target.checked)}/> Show Testers</label>
    </div>
    <div className="card" style={{padding:0,overflowX:'auto'}}>
      <table>
        <thead><tr><th>Name</th><th>Company</th><th>Title</th><th>Industry</th><th>Score</th><th>Tier</th><th>Date</th></tr></thead>
        <tbody>
          {filtered.map((r,i)=>{const s=parseFloat(r.overallScore)||0;const t=getTier(s);return(<tr key={i} style={{cursor:'pointer'}} onClick={()=>setSel(r)}><td><span style={{fontWeight:600}}>{r.fullName}</span>{isTester(r.emailDomain)&&<span className="tester-badge">Tester</span>}</td><td>{r.businessName}</td><td style={{color:'var(--g4)'}}>{r.title}</td><td style={{color:'var(--g4)',fontSize:12}}>{r.industry}</td><td><span style={{fontWeight:800,color:sc(s)}}>{s.toFixed(2)}</span></td><td><span className={`tier-badge ${tcls(t)}`}>{TNAMES[t]}</span></td><td style={{color:'var(--g4)',fontSize:12}}>{String(r.timestamp).substring(0,10)}</td></tr>);})}
          {!filtered.length&&<tr><td colSpan="7" style={{textAlign:'center',padding:'40px',color:'var(--g4)'}}>No responses match filters.</td></tr>}
        </tbody>
      </table>
    </div>
    {sel&&<RespModal r={sel} onClose={()=>setSel(null)}/>}
  </div>);
}

/* COMPANIES TAB */
function CompaniesTab({data}){
  const [sel,setSel]=useState(null);
  const groups={};
  data.forEach(r=>{const d=r.emailDomain||'unknown';if(!groups[d])groups[d]=[];groups[d].push(r);});
  const cos=Object.entries(groups).map(([domain,rows])=>({domain,rows,av:parseFloat(avg(rows.map(r=>parseFloat(r.overallScore)||0)).toFixed(2)),isTester:isTester(domain)}));
  const testers=cos.filter(c=>c.isTester);
  const customers=cos.filter(c=>!c.isTester).sort((a,b)=>b.av-a.av);
  const CoCard=({co})=>(<div className="co-card" onClick={()=>setSel(co)}><div className="co-name">{co.isTester?'ðŸ§ª Testers':co.domain}</div><div className="co-meta">{co.rows.length} respondent{co.rows.length!==1?'s':''}</div><div className="co-score" style={{color:sc(co.av)}}>{co.av.toFixed(2)}</div><div style={{marginBottom:10}}><span className={`tier-badge ${tcls(getTier(co.av))}`}>{TNAMES[getTier(co.av)]}</span></div><HM row={Object.fromEntries(DIMS.map(d=>[dk(d),avg(co.rows.map(r=>getDS(r,d)))]))} /></div>);
  return(<div>
    {testers.length>0&&<div style={{marginBottom:22}}><div style={{fontSize:12,fontWeight:700,letterSpacing:'.6px',textTransform:'uppercase',color:'var(--g4)',marginBottom:10}}>ðŸ§ª Testers â€” excluded from analytics</div><div className="co-grid">{testers.map(c=><CoCard key={c.domain} co={c}/>)}</div></div>}
    <div style={{fontSize:12,fontWeight:700,letterSpacing:'.6px',textTransform:'uppercase',color:'var(--g4)',marginBottom:10}}>Customer Companies</div>
    {customers.length?<div className="co-grid">{customers.map(c=><CoCard key={c.domain} co={c}/>)}</div>:<div className="empty"><div style={{fontSize:32,marginBottom:8}}>ðŸ¢</div><div style={{fontSize:16,fontWeight:700,color:'var(--navy)',marginBottom:6}}>No customer companies yet</div><div style={{fontSize:13}}>Responses will appear here once submitted.</div></div>}
    {sel&&<CoModal co={sel} onClose={()=>setSel(null)}/>}
  </div>);
}

/* TRENDS TAB */
function TrendsTab({data}){
  const real=data.filter(r=>!isTester(r.emailDomain));
  const sorted=[...real].sort((a,b)=>new Date(a.timestamp)-new Date(b.timestamp));
  const lineD=sorted.map((r,i)=>({name:`#${i+1}`,score:parseFloat(r.overallScore)||0}));
  const half=Math.floor(real.length/2);
  const h1=real.slice(0,half),h2=real.slice(half);
  const dimT=DIMS.map(d=>({dim:DSHORT[d]||d,first:parseFloat(avg(h1.map(r=>getDS(r,d))).toFixed(2)),second:parseFloat(avg(h2.map(r=>getDS(r,d))).toFixed(2))}));
  return(<div>
    <div className="card"><LineC data={lineD} xk="name" yk="score" title="Score Over Time"/></div>
    <div className="card"><GBar data={dimT} keys={["first","second"]} colors={["#C9C9C9","#0176D3"]} title="First Half vs Second Half by Dimension"/></div>
  </div>);
}

/* BEST PRACTICES TAB */
function LibraryTab(){
  return(<div>{Object.entries(BP).map(([dim,tiers])=>(<div key={dim} className="lib-section"><div className="lib-dim-title">{dim}</div><div className="lib-tiers">{tiers.map(({tier,what,sf,int:inv})=>(<div key={tier} className="lib-tier" style={{borderColor:TCOLORS[tier]+'55',background:tier===4?'#E0F7F622':tier===3?'#FFFDE744':tier===2?'#FFF3E044':'#FDECEA22'}}><div className="lib-tier-lbl" style={{color:TCOLORS[tier]}}>{TNAMES[tier]}</div><div className="lib-what">{what}</div><div className="lib-sf">ðŸ”µ {sf}</div><div className="lib-int">â†’ {inv}</div></div>))}</div></div>))}</div>);
}

/* APP */
function App(){
  const [authed,setAuthed]=useState(false);
  const [pw,setPw]=useState('');
  const [err,setErr]=useState(false);
  const [tab,setTab]=useState('overview');
  const [data,setData]=useState(SAMPLE);
  const [live,setLive]=useState(false);
  const configured=GOOGLE_SHEETS_API!=="https://script.google.com/macros/s/AKfycbxNKBVmPFc3OKrio5tMTAtmDhm0HHqvkcEAmF8uahf7aJGhJpBTLYkMfmysAICUAicxFA/exec";

  useEffect(()=>{
    if(!authed)return;
    try{
      const stored=JSON.parse(localStorage.getItem("sf_maturity_responses")||"[]");
      if(stored.length){
        setData(stored);
        setLive(true);
      }
    }catch(e){}
  },[authed]);

  const login=()=>{if(pw===ADMIN_PASSWORD){setAuthed(true);}else{setErr(true);setPw('');}};

  if(!authed)return(
    <div className="login-wrap">
      <div className="login-card">
        <div style={{display:'flex',justifyContent:'center',marginBottom:20}}><img src={LOGO} height="42" alt="Salesforce"/></div>
        <div className="login-title">Admin Dashboard</div>
        <div className="login-sub">B2B Sales Maturity Assessment</div>
        {err&&<div className="login-err">Incorrect password.</div>}
        <input className="login-input" type="password" placeholder="Admin password" value={pw} onChange={e=>{setPw(e.target.value);setErr(false);}} onKeyDown={e=>e.key==='Enter'&&login()}/>
        <button className="login-btn" onClick={login}>Sign In â†’</button>
      </div>
    </div>
  );

  const TABS=[['overview','ðŸ“Š Overview'],['responses','ðŸ“‹ All Responses'],['companies','ðŸ¢ Companies'],['trends','ðŸ“ˆ Trends'],['library','ðŸ“š Best Practices']];
  const content={overview:<OverviewTab data={data}/>,responses:<AllResponsesTab data={data}/>,companies:<CompaniesTab data={data}/>,trends:<TrendsTab data={data}/>,library:<LibraryTab/>};

  return(<div>
    <nav className="nav">
      <div className="nav-left">
        <img src={LOGO} height="34" alt="Salesforce"/>
        <div className="nav-divider"/>
        <span className="nav-label">B2B Sales Maturity Assessment â€” Admin</span>
      </div>
      <div style={{display:"flex",gap:8,alignItems:"center"}}>
        <button className="nav-out" onClick={()=>downloadCSV(data.filter(r=>!isTester(r.emailDomain)))}>â¬‡ Download CSV</button>
        <button className="nav-out" onClick={()=>setAuthed(false)}>Sign Out</button>
      </div>
    </nav>
    <div className="tabs">{TABS.map(([id,lbl])=><div key={id} className={`tab ${tab===id?'active':''}`} onClick={()=>setTab(id)}>{lbl}</div>)}</div>
    <div className="main">
      {!live&&<div className="banner">ðŸ“‹ Showing sample data â€” no responses submitted yet. Complete an assessment to see live data here.</div>}
      {content[tab]}
    </div>
  </div>);
}

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
